--- 
title: "As a Statistician"
author: "Zehui Bai"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: rstudio/bookdown-demo
description: "This book involves different statistical principles and methods, including the application of SAS and R, and aims to accumulate personal statistical knowledge."
---

# Introduction

Placeholder



<!--chapter:end:index.Rmd-->


# Input and Format

Placeholder


## Input data into SAS
### Reading free formatted data instream
### Reading fixed formatted data instream
### INFILE: Reading fixed formatted data from an external file
### Write the SAS File
### Import csv data
### %Import
### Infile Read multiple raw data files
### Generate automatic file name
## Input and import data in R
### Import csv data
### Import txt data
### Import excel data
### Import stata data
### Import SAS data
### Copy from clipboard
## Save and write objective in R
### Save as R-Datei
### write.table and write.csv
### write.foreign
### write.xlsx
### Save the plot
## Format in SAS
### Proc format 
### Copy and combine SAS format libraries
## Package readr 
## Package Strings
## Package forcats
## Package lubridate

<!--chapter:end:02-Input-and-Format.Rmd-->


# Data Management in SAS

Placeholder


## Array
### Defining
### Format multiple variables
### 2*2 arrays
### Dynamic Element List using Macro Variables
### Carry over values
## Retain
### Change from Basilne
## Variable Names and Types
### Convert all numeric to char*
### Get all the numeric variable names
### Write all variable names as macro variables
### Write all observations as macro variable
### Rename some variables
### Rename with suffix
### Rename array variables
## Check exists for validation
### Check datasets exists
### Check datasets and Variables
### Check datasets if empty
### %sysfunc get the observations
## Proc Transpose
### _numeric_
### In processing
## Clean Up
### Basic setting
### Delete datasets
### Deleting Formats
### Remove assigned formats
### Delete macro variables
### Delete Macro

<!--chapter:end:03-DM-in-SAS.Rmd-->


# Data Management in R

Placeholder


## Package tidyr 
### Pivoting
### gather and spread
### separate and unite
## Package dplyr 
### Data Transformation with dplyr
### across
### arrange
### coalesce
### filter
### if_else
### join
### mutate
### select
### summarise

<!--chapter:end:04-DM-in-R.Rmd-->


# SQL

Placeholder


## MySQL: Management
## MySQL PHP (In processing)
## PROC SQL in SAS
### Inreoduction
### Create Normal Table
### Creating Tables like an Existing Table
### Inserting Rows
### Delete Rows and Table
### New Columns using Summary Function
### Aggregation: Summary
### Conditionality (If)
### Filtering Aggregated Data (HAVING)
### Select Operator (Union...)
### Loap
### Join
### Reordering Rows (Proc Sort)
## Package DBI (In processing)
## Package sparklyr (In processing)

<!--chapter:end:05-SQL.Rmd-->

# ggplot2


```{r mind map,echo = F,message = FALSE, error = FALSE, warning = FALSE}
library('mindr')
### text -> widget
### input <- c("# Chapter 1", "## Section 1.1", "### Section 1.1.1", "## Section 1.2", "# Chapter 2")
### mm(from = input, type = "text", root = "mindr")
filename <- rstudioapi::getSourceEditorContext()$path
widget <- mm(from = filename, type = "file", root = "")
widget
```

## Parametric Rendering

### Grammar

ggplot2 implements the idea of a "grammar of graphics". The grammar implemented by ggplot2 could be summarized as follows:

* plot ::= coord scale+ facet? layer+
* layer ::= data mapping stat geom position?

A plot is defined by a coordinate system (coord), one or more scales (scale), an optional faceting specification (facet), and one or more layers (layer). A layer is defined as an R data frame (data), a specification mapping columns of that frame into aesthetic properties (mapping), a statistical approach to summarize the rows of that frame (stat), a geometric object to visually represent that summary (geom), and an optional position adjustment to move overlapping geometric objects out of their way (position).


### coord

* coord_cartesian - (default) cartesian coordinate system (x horizontal from left to right, y vertical from bottom to top)
* coord_flip - flipped cartesian coordinate system (x vertical from bottom to top, y horizontal from left to right)
* coord_trans
* coord_equal
* coord_polar - polar coordinate system; the x (or y) scale is mapped to the angle (theta)
* coord_map - various map projections

<!-- coord_cartesian（默认）笛卡尔坐标系, coord_flip 直角坐标系 -->


### facet

* facet_wrap(~cell) - univariate: create a 1-d strip of panels, based on one factor, and wrap the strip into a 2-d matrix
* facet_grid(row~col) - (usually) bivariate: create a 2-d matrix of panels, based on two factors


### geom

| geom       | Useful stats (default in bold) | Default position adjustment | Parameters (when used with given stat)                                                                                                            |
|------------|--------------------------------|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| blank      | identity                       | identity                    | no parameters                                                                                                                                     |
| abline     | abline                         | identity                    | slope, intercept, size, linetype, colour, alpha                                                                                                   |
|            | identity                       | identity                    | slope, intercept, size, linetype, colour, alpha                                                                                                   |
| hline      | hline                          | identity                    | yintercept, size, linetype, colour, alpha                                                                                                         |
|            | identity                       | identity                    | y, yend, size, linetype, colour, alpha                                                                                                            |
| vline      | vline                          | identity                    | xintercept, size, linetype, colour, alpha                                                                                                         |
|            | identity                       | identity                    | x, xend, size, linetype, colour, alpha                                                                                                            |
| text       | identity                       | identity                    | x, y, label, size, colour, alpha, hjust, vjust, parse                                                                                             |
| point      | identity                       | identity                    | x, y, size, shape, colour, fill, alpha, na.rm                                                                                                     |
| jitter     | identity                       | jitter                      | x, y, size, shape, colour, fill, alpha, na.rm                                                                                                     |
| segment    | identity                       | identity                    | x, xend, y, yend, size, linetype, colour, alpha, arrow                                                                                            |
| line       | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, arrow                                                                                                 |
| bar        | identity                       | stack                       | x, y, size, linetype, colour, fill, alpha, weight(?) ???                                                                                          |
|            | bin                            | stack                       | x, y, size, linetype, colour, fill, alpha, weight(?) ???                                                                                          |
| histogram  | alias for geom_bar             |                             |                                                                                                                                                   |
| area       | identity                       | stack                       | group, x, y, size, linetype, colour, fill, alpha, na.rm                                                                                           |
| ribbon     | identity                       | identity                    | group, x, ymin, ymax, size, linetype, colour, fill, alpha, na.rm                                                                                  |
| linerange  | identity                       | identity                    | x, ymin, ymax, size, linetype, colour, alpha                                                                                                      |
| pointrange | identity                       | identity                    | x, y, ymin, ymax, size, shape, linetype, colour, fill, alpha                                                                                      |
| errorbar   | identity                       | identity                    | x, ymin, ymax, size, linetype, colour, alpha, width                                                                                               |
| errorbarh  | identity                       | identity                    | x, xmin, xmax, y, size, linetype, colour, alpha, height                                                                                           |
| crossbar   | identity                       | identity                    | x, y, ymin, ymax, size, linetype, colour, fill, alpha, width, fatten                                                                              |
| boxplot    | identity                       | dodge                       | x, ymin, lower, middle, upper, ymax, size, colour, fill, alpha, weight(?), width(?), outliers(?), outlier.size, outlier.shape, outlier.colour ??? |
|            | boxplot                        | dodge                       | x, ymin, lower, middle, upper, ymax, size, colour, fill, alpha, weight(?), width(?), outliers(?), outlier.size, outlier.shape, outlier.colour ??? |
| path       | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, na.rm, arrow, linemitre, linejoin, lineend                                                            |
| polygon    | identity                       | identity                    | group, x, y, size, linetype, colour, fill, alpha                                                                                                  |
| rect       | identity                       | identity                    | xmin, xmax, ymin, ymax, size, linetype, colour, fill, alpha                                                                                       |
| rug        | identity                       | identity                    | x, y, size, linetype, colour, alpha                                                                                                               |
| step       | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, direction                                                                                             |
| bin2d      | identity                       | identity                    | xmin, xmax, ymin, ymax, size, linetype, colour, fill, alpha, weight(?) ???                                                                        |
|            | bin2d                          | identity                    | xmin, xmax, ymin, ymax, size, linetype, colour, fill, alpha, weight(?) ???                                                                        |
| tile       | identity                       | identity                    | x, y, size, linetype, colour, fill, alpha                                                                                                         |
| hex        | identity                       | identity                    | x, y, size, colour, fill, alpha                                                                                                                   |
|            | binhex                         | identity                    | x, y, size, colour, fill, alpha                                                                                                                   |
| density    | identity                       | identity                    | group, x, y, size, linetype, colour, fill, alpha, weight(?) ???                                                                                   |
|            | density                        | identity                    | group, x, y, size, linetype, colour, fill, alpha, weight(?) ???                                                                                   |
| density2d  | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ???                                             |
|            | density2d                      | identity                    | group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ???                                             |
| contour    | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ???                                             |
|            | contour                        | identity                    | group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ???                                             |
| freqpoly   | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, weight(?) ???                                                                                         |
|            | bin                            | identity                    | group, x, y, size, linetype, colour, alpha, weight(?) ???                                                                                         |
| quantile   | identity                       | identity                    | group, x, y, size, linetype, colour, alpha, na.rm, arrow, linemitre, linejoin, lineend                                                            |
|            | quantile                       | identity                    | group, x, y, size, linetype, colour, alpha, weight, quantiles, formula, xseq, method, na.rm, arrow, linemitre, linejoin, lineend                  |
| smooth     | identity                       | identity                    | group, x, y, ymin, ymax, size, linetype, colour, fill, alpha                                                                                      |
|            | smooth                         | identity                    | group, x, y, size, linetype, colour, fill, alpha, weight                                                                                          |


### position

* position_identity - default of most geoms
* position_jitter - default of geom_jitter
* position_dodge - default of geom_boxplot
* position_stack - default of geom_bar==geom_histogram and geom_area
* position_fill - useful for geom_bar==geom_histogram and geom_area

### scale

* size - size of a geom
* shape - shape of a geom
* linetype - type of a geom's outline (e.g., dashed, dotted)
* colour - color of a geom's outline
* fill - color of a geom's fill
* alpha - transparency of a geom (0=transparent ... 1=opaque)

Functions that ggplot2 provides to define each of the above kinds of scales. 

* x (or y) position
    + scale_x_continuous
    + scale_x_date
    + scale_x_datetime
    + scale_x_discrete
* size
    + scale_size_continuous
    + scale_area
    + scale_size_discrete
    + scale_size_identity
    + scale_size_manual
* shape
    + scale_shape_discrete
    + scale_shape_identity
    + scale_shape_manual
* linetype
    + scale_linetype_discrete
    + scale_linetype_identity
    + scale_linetype_manual
* colour (or fill)
    + scale_colour_gradient
    + scale_colour_gradient2
    + scale_colour_gradientn
    + scale_colour_hue
    + scale_colour_brewer
    + scale_colour_grey
    + scale_colour_identity
    + scale_colour_manual
* alpha
    + scale_alpha_continuous

### stat

* stat_abline - used by geom_abline
* stat_bin - used by geom_bar == geom_histogram, and geom_freqpoly
* stat_bin2d - used by geom_bin2d
* stat_binhex - used by geom_hex
* stat_boxplot - used by geom_boxplot
* stat_contour - used by geom_contour
* stat_density - used by geom_density
* stat_density2d - used by geom_density2d
* stat_ecdf
* stat_function
* stat_hline - used by geom_hline
* stat_identity - used by a large number of geoms
* stat_qq
* stat_quantile - used by geom_quantile
* stat_smooth - used by geom_smooth
* stat_spoke
* stat_sum
* stat_summary
* stat_unique
* stat_vline - used by geom_vline

### Color
    + [ColorBrewer scales](https://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3)
    + Hexadecimal color code chart
    
```{r Hexadecimal color code chart, echo=FALSE, fig.align="center", out.width = '100%',fig.cap="Figure: Hexadecimal color code chart"}
knitr::include_graphics("./02_Plots/ggplot2_Hexadecimal_Color_Code.png")
```

### Thema

* theme_grey() - the default theme, with a grey background
* theme_bw() - a theme with a white background

ggplot2 includes eight themes by default, as shown in Figure. Many more are included in add-on packages like [ggthemes](https://github.com/jrnold/ggthemes), by Jeffrey Arnold.

```{r Thema, echo=FALSE, fig.align="center", out.width = '100%',fig.cap="Figure: ggplot2 Thema"}
knitr::include_graphics("./02_Plots/ggplot2_ggthemes.png")
```

### Saving plots

```
# Save the plot
ggsave(p, filename = "chartFromRPractical.png")
```


## Scatter plot

### Grouping Aesthetic

* Color Aesthetic
* Size Aesthetic
* Alpha Aesthetic
* Shape Aesthetic


```{r the aesthetic, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library(ggplot2)
## Color Aesthetic
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))

## Set the aesthetic properties of your geom manually
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")

## Size Aesthetic
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))

## Alpha aesthetic, which controls the transparency of the points
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))

## shape aesthetic
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))

data(iris)
theme_set(theme_bw())
ggplot(data = iris, mapping = aes(x = Petal.Length, y = Petal.Width, shape = Species)) +
  geom_point(aes(color = Species), size = 3) +
  scale_colour_manual(values=c("#3399CC","#33FF33","#FFCC33"))+
  scale_shape_manual(values = c(1,2,3)) +
  xlab("Petal Length") +  ylab("Petal Width") +
  ylim(0, 3)+
  ggtitle("Petal Width and Length") +
  theme(plot.title = element_text(hjust = 0.5,face = "bold"),
        legend.title = element_blank(),
        legend.position = c(0.1, 0.85))
```

### facet

facet_wrap(), "winding facet", only one standard can be applied to data classification, and the small shapes obtained from different sets of data are arranged in the order of "winding" from left to right and from top to bottom

facet_grid(), facet the drawing of the combination of two variables

```{r facet_wrap and facet_grid, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(.~ class, nrow = 2)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(.~ class)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(drv ~ cyl)
```

**Replacing facet strips with text boxes using ggtext::**

```{r Replacing facet strips, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("cowplot")

ggplot(mpg, aes(cty, hwy)) + 
  geom_point() +
  facet_wrap(~class) +
  theme_half_open(12) +
  background_grid() 

library("ggtext")
ggplot(mpg, aes(cty, hwy)) + 
  geom_point() +
  facet_wrap(~class) +
  theme_half_open(12) +
  background_grid() +
  theme(
    strip.background = element_blank(),
    strip.text = element_textbox(
      size = 12,
      color = "white", fill = "#5D729D", box.color = "#4A618C",
      halign = 0.5, linetype = 1, r = unit(5, "pt"), width = unit(1, "npc"),
      padding = margin(2, 0, 1, 0), margin = margin(3, 3, 3, 3)
    )
  )
```


### geom_smooth

```{r Grouping Aesthetic, echo = T,message = FALSE, error = FALSE, warning = FALSE}
## display different aesthetics in different layers
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth()

## no aesthetic just grouping
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv)) +
  geom_point(mapping = aes(x = displ, y = hwy, color = class))

## linetype aesthetic set the shape of a point
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))

## color aesthetic
ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE
  )

## Linear line
ggplot(mpg, aes(cty, hwy))+
  geom_point() + 
  geom_smooth(method="lm", se=F) +
  theme_bw()+
  labs(subtitle="mpg: city vs highway mileage", 
       y="hwy", 
       x="cty", 
       title="Scatterplot with overlapping points", 
       caption="Source: midwest")

## 原始数据有234个数据点，但图表似乎显示的点更少
## 这是因为有许多重叠的点显示为单个点。在源数据集中cty和hwy都是整数
## 可以使用jitter_geom（）绘制一个抖动图
ggplot(mpg, aes(cty, hwy))+
  geom_point() + 
  theme_bw()+
  geom_jitter(width = .5, size=1) +
  labs(subtitle="mpg: city vs highway mileage", 
       y="hwy", 
       x="cty", 
       title="Jittered Points")
```



### Dot Plot

Order `fct_reorder`: Modifying factor order 

```{r fct_reorder, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library(forcats)
library(dplyr)
relig_summary <- gss_cat %>%
  group_by(relig) %>%
  summarise(
    age = mean(age, na.rm = TRUE),
    tvhours = mean(tvhours, na.rm = TRUE),
    n = n()
  )

ggplot(relig_summary, aes(tvhours, relig)) + geom_point()
ggplot(relig_summary, aes(tvhours, fct_reorder(relig, tvhours))) +
  geom_point()

```

**Diverging Dot Plot **

```{r Diverging Dot Plot , echo = T,message = FALSE, error = FALSE, warning = FALSE}
# Data Prep
data("mtcars")  # load data
mtcars$`car name` <- rownames(mtcars)  # create new column for car names
mtcars$mpg_z <- round((mtcars$mpg - mean(mtcars$mpg))/sd(mtcars$mpg), 2)  # compute normalized mpg
mtcars$mpg_type <- ifelse(mtcars$mpg_z < 0, "below", "above")  # above / below avg flag
mtcars <- mtcars[order(mtcars$mpg_z), ]  # sort
mtcars$`car name` <- factor(mtcars$`car name`, levels = mtcars$`car name`)  # convert to factor to retain sorted order in plot.


ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) + 
  geom_point(stat='identity', aes(col=mpg_type), size=6)  +
  scale_color_manual(name="Mileage", 
                     labels = c("Above Average", "Below Average"), 
                     values = c("above"="#00ba38", "below"="#f8766d")) + 
  geom_text(color="white", size=2) +
  labs(title="Diverging Dot Plot", 
       subtitle="Normalized mileage from 'mtcars': Dotplot") + 
  ylim(-2.5, 2.5) +
  coord_flip()

 
### Diverging Lollipop Chart
ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) + 
  geom_point(stat='identity', fill="black", size=6)  +
  geom_segment(aes(y = 0, 
                   x = `car name`, 
                   yend = mpg_z, 
                   xend = `car name`), 
               color = "black") +
  geom_text(color="white", size=2) +
  labs(title="Diverging Lollipop Chart", 
       subtitle="Normalized mileage from 'mtcars': Lollipop") + 
  ylim(-2.5, 2.5) +
  coord_flip()



# Diverging Barcharts
ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) + 
  geom_bar(stat='identity', aes(fill=mpg_type), width=.5)  +
  scale_fill_manual(name="Mileage", 
                    labels = c("Above Average", "Below Average"), 
                    values = c("above"="#00ba38", "below"="#f8766d")) + 
  labs(subtitle="Normalised mileage from 'mtcars'", 
       title= "Diverging Bars") + 
  coord_flip() +
  theme_bw()
```



### Label and Title

`+ ggtitle("Area Vs Population", subtitle="From midwest dataset") + xlab("Area") + ylab("Population")`

```{r ggtitle, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(midwest, aes(x=area, y=poptotal)) + 
  geom_point() + 
  geom_smooth(method="lm") + 
  coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000)) + 
  labs(title="Area Vs Population", subtitle="From midwest dataset", y="Population", x="Area", caption="Midwest Demographics")

## Or
ggplot(midwest, aes(x=area, y=poptotal)) + 
  geom_point() + 
  geom_smooth(method="lm") + 
  coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000)) + 
  ggtitle("Area Vs Population", subtitle="From midwest dataset") + xlab("Area") + ylab("Population")
```


**Change the Title rendering using ggtext::element_textbox()**

```{r element_textbox, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(mtcars, aes(disp, mpg)) + 
  geom_point() +
  labs(
    title = "<b>Fuel economy vs. engine displacement</b><br>
    <span style = 'font-size:10pt'>Lorem ipsum *dolor sit amet,*
    consectetur adipiscing elit, **sed do eiusmod tempor incididunt** ut
    labore et dolore magna aliqua. <span style = 'color:red;'>Ut enim
    ad minim veniam,</span> quis nostrud exercitation ullamco laboris nisi
    ut aliquip ex ea commodo consequat.</span>",
    x = "displacement (in<sup>3</sup>)",
    y = "Miles per gallon (mpg)<br><span style = 'font-size:8pt'>A measure of
    the car's fuel efficiency.</span>"
  ) +
  theme(
    plot.title.position = "plot",
    plot.title = element_textbox_simple(
      size = 13,
      lineheight = 1,
      padding = margin(5.5, 5.5, 5.5, 5.5),
      margin = margin(0, 0, 5.5, 0),
      fill = "cornsilk"
    ),
    axis.title.x = element_textbox_simple(
      width = NULL,
      padding = margin(4, 4, 4, 4),
      margin = margin(4, 0, 0, 0),
      linetype = 1,
      r = grid::unit(8, "pt"),
      fill = "azure1"
    ),
    axis.title.y = element_textbox_simple(
      hjust = 0,
      orientation = "left-rotated",
      minwidth = unit(1, "in"),
      maxwidth = unit(2, "in"),
      padding = margin(4, 4, 2, 4),
      margin = margin(0, 0, 2, 0),
      fill = "lightsteelblue1"
    )
  )
```


### Residuals


```
modf2 <- fortify(lm(formular, data = rf10_comp))
ggplot(modf2, aes(x = modf$bmi, y = .resid)) + geom_point()+
  geom_hline(aes(yintercept=0), colour="#990000") +
  labs(title="Residuals plot for BMI using MICE RF with 10 trees",
       x = "BMI",
       y = "Residuals")+
  theme_classic()
  
## Standardized Residuals
modf <- fortify(lm(formular, data = data))
ggplot(modf, aes(x = modf$bmi, y = .stdresid)) + geom_point()+
  geom_hline(aes(yintercept=0), colour="#990000") +
  labs(title="Standardised residuals plot for BMI using Full data",
       x = "BMI",
       y = "Residuals")+
  theme_classic()
```


### Encircling

In geom_encircle(), set the data to a new data frame containing only points (rows) or points of interest. In addition, you can expand the curve so that it passes outside the point. The color and size (thickness) of the curve can also be modified.

<!-- 在图表中加上某些特殊的点或区域组，以便引起人们对这些特殊情况的注意。 可以使用ggalt包中的geom_encircle（）方便地完成此操作。 -->

```{r Encircling for emphasizen, echo = T,message = FALSE, error = FALSE, warning = FALSE}
# install 'ggalt' pkg
# devtools::install_github("hrbrmstr/ggalt")
options(scipen = 999)
library(ggalt)
midwest_select <- midwest[midwest$poptotal > 350000 & 
                            midwest$poptotal <= 500000 & 
                            midwest$area > 0.01 & 
                            midwest$area < 0.1, ]

# Plot
ggplot(midwest, aes(x=area, y=poptotal)) + 
  geom_point(aes(col=state, size=popdensity)) +   # draw points
  geom_smooth(method="loess", se=F) + 
  xlim(c(0, 0.1)) + 
  ylim(c(0, 500000)) +   # draw smoothing line
  geom_encircle(aes(x=area, y=poptotal), 
                data=midwest_select, 
                color="red", 
                size=2, 
                expand=0.08) +   # encircle
  labs(subtitle="Area Vs Population", 
       y="Population", 
       x="Area", 
       title="Scatterplot + Encircle", 
       caption="Source: midwest")
```

### Dumbbell Plot 

1. 可视化两个时间点之间的相对位置（如增长和下降）。
2. 比较两个类别之间的距离。

为了获得正确的哑铃排序，应将Y变量作为一个因子，并且该因子变量的级别应与在图中显示的顺序相同。

```{r Dumbbell Plot , echo = T,message = FALSE, error = FALSE, warning = FALSE}
library(ggalt) 

health <- read.csv("https://raw.githubusercontent.com/selva86/datasets/master/health.csv")
health$Area <- factor(health$Area, levels=as.character(health$Area))  # for right ordering of the dumbells

# health$Area <- factor(health$Area)
ggplot(health, aes(x=pct_2013, xend=pct_2014, y=Area, group=Area)) + 
  geom_dumbbell(color="#a3c4dc", 
                size=0.75, 
                point.colour.l="#0e668b") + 
  labs(x=NULL, 
       y=NULL, 
       title="Dumbbell Chart", 
       subtitle="Pct Change: 2013 vs 2014", 
       caption="Source: https://github.com/hrbrmstr/ggalt") +
  theme_classic()+
  theme(plot.title = element_text(hjust=0.5, face="bold"),
        plot.background=element_rect(fill="#f7f7f7"),
        panel.background=element_rect(fill="#f7f7f7"),
        panel.grid.minor=element_blank(),
        panel.grid.major.y=element_blank(),
        panel.grid.major.x=element_line(),
        axis.ticks=element_blank(),
        legend.position="top",
        panel.border=element_blank())
```




## Histogram 

### General appearance

```{r Appearance, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("tidyverse")
smaller <- diamonds %>% 
  filter(carat < 3)
ggplot(data = smaller, mapping = aes(x = carat, fill=color))+
  geom_histogram(binwidth = 0.1, col="black", size=.1) +
  labs(title="Histogram with Auto Binning", 
       subtitle="Engine Displacement across Vehicle Classes")  
## geom_histogram(bins=5, col="black", size=.1) 

## Change the color according the number of legend
## scale_color_manual(values = c("#00AFBB", "#E7B800")) 
## scale_fill_manual(values = c("#00AFBB", "#E7B800"))
```

### Themes

ggplot2 offers a set of pre-built themes. Try the followings to see which one you like the most:

* theme_bw()
* theme_dark()
* theme_minimal()
* theme_classic()

The hrbrthemes package provides my favourite style.

```{r hrbrthemes, echo = T,message = FALSE, error = FALSE, warning = FALSE}
# Load dataset from github
data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv", header=TRUE)
# Make the histogram
library(hrbrthemes)
data %>%
  filter( price<300 ) %>%
  ggplot( aes(x=price)) +
    stat_bin(breaks=seq(0,300,10), fill="#69b3a2", color="#e9ecef", alpha=0.9) +
    ggtitle("Night price distribution of Airbnb appartements") +
    theme_ipsum()
```

### geom_freqpoly()


```{r freqpoly, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("tidyverse")
smaller <- diamonds %>% 
  filter(carat < 3)
ggplot(data = smaller, mapping = aes(x = carat, colour = cut)) +
  geom_freqpoly(binwidth = 0.1)


## display density instead of count
ggplot(data = diamonds, mapping = aes(x = price, y = ..density..)) + 
  geom_freqpoly(mapping = aes(colour = cut), binwidth = 500)

## geom_density
ggplot(mpg, aes(cty)) +
  geom_density(aes(fill=factor(cyl)), alpha=0.5) + 
    labs(title="Density plot", 
         subtitle="City Mileage Grouped by Number of cylinders",
         caption="Source: mpg",
         x="City Mileage",
         fill="# Cylinders")
```



### Marginal Histogram / Boxplot

This can be achieved using the ggMarginal() function in the "ggExtra" package. In addition to histograms, you can choose to draw marginal box plots or density plots by setting the corresponding type options.

```{r Marginal Plot, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("ggExtra")

mpg_select <- mpg[mpg$hwy >= 35 & mpg$cty > 27, ]
g <- ggplot(mpg, aes(cty, hwy)) + 
  geom_count() + 
  geom_smooth(method="lm", se=F) +
  theme_bw()

ggMarginal(g, type = "histogram", fill="transparent")
ggMarginal(g, type = "boxplot",   fill="transparent")
ggMarginal(g, type = "density",   fill="transparent")
```



### Scales

Scales control the details of how data values are translated to visual properties. Many [different scales](https://ggplot2.tidyverse.org/reference/index.html#section-scales) are offered by ggplot2. The most widely one is probably the log scale.


```{r Change Scales, echo = T,message = FALSE, error = FALSE, warning = FALSE}

# Load dataset from github
data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv", header=TRUE)

# Make the histogram
data %>%
  ggplot( aes(x=price)) +
    geom_histogram(color="white", fill="steelblue4") +
    ggtitle("Night price distribution of Airbnb appartements") +
    xlab("Night price") +
    ylab("Number of apartments")

data %>%
  ggplot( aes(x=price)) +
    geom_histogram(color="white", fill="steelblue4") +
    ggtitle("Night price distribution of Airbnb appartements") +
    xlab("Night price") +
    ylab("Number of apartments") +
    scale_x_log10()
```



## Bar plot

### Aesthetic

```{r Aesthetic, echo = T,message = FALSE, error = FALSE, warning = FALSE}
## Color Aesthetic
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = cut ))

ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color ))


## Position aesthetic
## position adjustment options: "identity", "dodge" or "fill".
## position =“ fill”的作用类似于堆叠，但是使每组堆叠的条具有相同的高度。 这样可以更轻松地比较各组之间的比例。
## position =“ dodge”将重叠的对象彼此相邻放置。 这样可以更轻松地比较各个值。

ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + 
  geom_bar(alpha = 1/5, position = "identity")

ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + 
  geom_bar(fill = NA, position = "identity")+
  facet_wrap(~color) +
  theme(legend.position = "top")

ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill", width = 0.5) + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6)) + 
  labs(title="Histogram on Categorical Variable", 
       subtitle="Manufacturer across Vehicle Classes") 
 
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge")
```

**Change outline colors**

It is also possible to change manually barplot line colors using the functions :

* scale_color_manual() : to use custom color palettes
    + `p+scale_color_manual(values=c("#999999", "#E69F00", "#56B4E9"))`
* scale_color_brewer() : to use color palettes from RColorBrewer package
    + `p+scale_color_brewer(palette="Dark2")`
* scale_color_grey() : to use grey color palettes
    + `p + scale_color_grey() + theme_classic()`

**Change fill colors**

* scale_fill_manual() : to use custom colors
    + `p+scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9"))`
* scale_fill_brewer() : to use color palettes from RColorBrewer package
    + `p+scale_fill_brewer(palette="Dark2")`
* scale_fill_grey() : to use grey color palettes
    + `p + scale_fill_grey()`

**Change the legend position**

* Change bar fill colors to blues
    + `p <- p+scale_fill_brewer(palette="Blues")`
* Change the legend position
    + `p + theme(legend.position="top")`
    + `p + theme(legend.position="bottom")`
* Remove legend
    + `p + theme(legend.position="none")`
* Change the order of items in the legend
    + `p + scale_x_discrete(limits=c("D2", "D0.5", "D1"))`

  




### Proportion

```{r proportion, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color ))
 
## proportion, rather than count:
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = ..prop.., group = 1))+
  scale_y_continuous(labels = scales::percent) +
  labs(title="Name")+
  theme_classic()
```
### coord

```{r coordinary system, echo = T,message = FALSE, error = FALSE, warning = FALSE}
## coord_polar() uses polar coordinates
bar <- ggplot(data = diamonds) + 
  geom_bar(
    mapping = aes(x = cut, fill = cut), 
    show.legend = FALSE,
    width = 1
  ) + 
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)
bar + coord_flip()
bar + coord_polar()
```

### stat="identity"

```{r identity, echo = T,message = FALSE, error = FALSE, warning = FALSE}
Rotation_5 <- readRDS(file = "./01_Datasets/Rotation_5.rds")

ggplot(data = Rotation_5, aes(x = Visit, y= Percentage, fill=Treatment)) +
  geom_bar(stat="identity", width =0.5,
           position=position_dodge()) +
  geom_text(aes(label=N), vjust=1.6, color="white",
            position = position_dodge(0.5), size=3.5)+
  geom_text(aes(label=P, x=Visit, y=0.97),hjust=0.4, size=3.5)+
  scale_fill_brewer(palette="Paired")+
  scale_y_continuous(labels = scales::percent, breaks=seq(0, 1, 0.1)) +
  theme_bw() +
  theme(legend.position = "none") +
  labs(x = "",
       y = "Responder rate",
       title = "Rotational stability within 5° from Visit H0 (sitting)")

```


### Ranking

```{r Ranking the bar, echo = T,message = FALSE, error = FALSE, warning = FALSE}
### Ordered Bar Chart 
cty_mpg <- aggregate(mpg$cty, by=list(mpg$manufacturer), FUN=mean)  # aggregate
colnames(cty_mpg) <- c("make", "mileage")  # change column names
cty_mpg <- cty_mpg[order(cty_mpg$mileage), ]  # sort
cty_mpg$make <- factor(cty_mpg$make, levels = cty_mpg$make)  # to retain the order in plot.

# Draw plot
ggplot(cty_mpg, aes(x=make, y=mileage)) + 
  geom_bar(stat="identity", width=.5, fill="tomato3") + 
  labs(title="Ordered Bar Chart", 
       subtitle="Make Vs Avg. Mileage", 
       caption="source: mpg") + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6)) +
  theme_bw()





### Lollipop Chart
### Lollipop charts conveys the same information as in bar charts. By reducing the thick bars into thin lines, it reduces the clutter and lays more emphasis on the value. It looks nice and modern.
ggplot(cty_mpg, aes(x=make, y=mileage)) + 
  geom_point(size=3) + 
  geom_segment(aes(x=make, 
                   xend=make, 
                   y=0, 
                   yend=mileage)) + 
  labs(title="Lollipop Chart", 
       subtitle="Make Vs Avg. Mileage", 
       caption="source: mpg") + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6))
```




### Means and error bars

```{r geom_errorbar, echo = T,message = FALSE, error = FALSE, warning = FALSE}
PrimEnd <- data.frame('Primary Endpoint'=c("Primary Analysis", 
                                           "Sensitivity Analysis 1",
                                           "Sensitivity Analysis 2",
                                           "Primary Analysis after imputation"),
                      mean=c(-0.2945, -0.08334, -0.2926, -0.2395),
                      LL=c(-0.9612, -0.2861, -0.9344, -0.7521),
                      UL=c(0.3722, 0.1194, 0.3491, 0.2730),
                      pvalue=c("P = 0.313", "P = 0.347", "P = 0.304","P = 0.359"))
level <- PrimEnd$Primary.Endpoint

PrimEnd$Primary.Endpoint <- factor(PrimEnd$Primary.Endpoint, levels=level)
library(ggplot2)
ggplot(PrimEnd, aes(x=Primary.Endpoint, y=mean)) + 
  geom_line() +
  geom_point()+
  geom_text(aes(label=pvalue),hjust=-0.2, vjust=0) +
  geom_hline(aes(yintercept=0, color="black", linetype="dot")) + 
  geom_errorbar(aes(ymin=LL, ymax=UL), width = 0.5, size = 0.5)+
  theme_bw() +
  theme(legend.position = "none") +
  labs(x = "",
       y = "Difference between the IOLs",
       title = "Superiority analysis in mean absolute rotation between Visit H0 (sitting) and H1")





tg <- ToothGrowth
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {
    library(plyr)

    # New version of length which can handle NA's: if na.rm==T, don't count them
    length2 <- function (x, na.rm=FALSE) {
        if (na.rm) sum(!is.na(x))
        else       length(x)
    }

    # This does the summary. For each group's data frame, return a vector with
    # N, mean, and sd
    datac <- ddply(data, groupvars, .drop=.drop,
      .fun = function(xx, col) {
        c(N    = length2(xx[[col]], na.rm=na.rm),
          mean = mean   (xx[[col]], na.rm=na.rm),
          sd   = sd     (xx[[col]], na.rm=na.rm)
        )
      },
      measurevar
    )

    # Rename the "mean" column    
    datac <- rename(datac, c("mean" = measurevar))

    datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean

    # Confidence interval multiplier for standard error
    # Calculate t-statistic for confidence interval: 
    # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
    ciMult <- qt(conf.interval/2 + .5, datac$N-1)
    datac$ci <- datac$se * ciMult

    return(datac)
}
tgc <- summarySE(tg, measurevar="len", groupvars=c("supp","dose"))
# The errorbars overlapped, so use position_dodge to move them horizontally
pd <- position_dodge(0.1) 
ggplot(tgc, aes(x=dose, y=len, colour=supp, group=supp)) + 
    geom_errorbar(aes(ymin=len-se, ymax=len+se), colour="black", width=.1, position=pd) +
    geom_line(position=pd) +
    geom_point(position=pd, size=3, shape=21, fill="white") + # 21 is filled circle
    xlab("Dose (mg)") +
    ylab("Tooth length") +
    scale_colour_hue(name="Supplement type",    # Legend label, use darker colors
                     breaks=c("OJ", "VC"),
                     labels=c("Orange juice", "Ascorbic acid"),
                     l=40) +                    # Use darker colors, lightness=40
    ggtitle("The Effect of Vitamin C on\nTooth Growth in Guinea Pigs") +
    expand_limits(y=0) +                        # Expand y range
    scale_y_continuous(breaks=0:20*4) +         # Set tick every 4
    theme_bw() +
    theme(legend.justification=c(1,0),
          legend.position=c(1,0))               # Position legend in bottom right



tgc2 <- tgc
tgc2$dose <- factor(tgc2$dose)
ggplot(tgc2, aes(x=dose, y=len, fill=supp)) + 
    geom_bar(position=position_dodge(), stat="identity",
             colour="black", # Use black outlines,
             size=.3) +      # Thinner lines
    geom_errorbar(aes(ymin=len-se, ymax=len+se),
                  size=.3,    # Thinner lines
                  width=.2,
                  position=position_dodge(.9)) +
    xlab("Dose (mg)") +
    ylab("Tooth length") +
    scale_fill_hue(name="Supplement type", # Legend label, use darker colors
                   breaks=c("OJ", "VC"),
                   labels=c("Orange juice", "Ascorbic acid")) +
    ggtitle("The Effect of Vitamin C on\nTooth Growth in Guinea Pigs") +
    scale_y_continuous(breaks=0:20*4) +
    theme_bw()
```




### Waffle Chart

Show a good way to make a total classification. Although there is no direct function, it can be clarified by using the geom_tile () function.

```{r geom_tile, echo = T,message = FALSE, error = FALSE, warning = FALSE}
var <- mpg$class  # the categorical data 

## Prep data (nothing to change here)
nrows <- 10
df <- expand.grid(y = 1:nrows, x = 1:nrows)
categ_table <- round(table(var) * ((nrows*nrows)/(length(var))))
categ_table

df$category <- factor(rep(names(categ_table), categ_table)) 

## Plot
ggplot(df, aes(x = x, y = y, fill = category)) + 
        geom_tile(color = "black", size = 0.5) +
        scale_x_continuous(expand = c(0, 0)) +
        scale_y_continuous(expand = c(0, 0), trans = 'reverse') +
        scale_fill_brewer(palette = "Set3") +
        labs(title="Waffle Chart", subtitle="'Class' of vehicles",
             caption="Source: mpg") + 
        theme(panel.border = element_rect(size = 2),
              plot.title = element_text(size = rel(1.2)),
              axis.text = element_blank(),
              axis.title = element_blank(),
              axis.ticks = element_blank(),
              legend.title = element_blank(),
              legend.position = "right")
```


## Box plot

### varwidth

```{r Boxplot using identity, echo = T,message = FALSE, error = FALSE, warning = FALSE}
theme_set(theme_classic())

ggplot(mpg, aes(class, cty))+
  geom_boxplot(varwidth=T, fill="plum") + 
    labs(title="Box plot", 
         subtitle="City Mileage grouped by Class of vehicle",
         caption="Source: mpg",
         x="Class of Vehicle",
         y="City Mileage")
```
### Reorder

Reorder: To make the trend easier to see, we can reorder class based on the median value of hwy:

```{r Reorder according to median, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(data = mpg) +
  geom_boxplot(mapping = aes(x = reorder(class, hwy, FUN = median), y = hwy))+
  coord_flip()
```
 
 
 
### Fill

```{r grouping using fill, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(mpg, aes(class, cty))+
  geom_boxplot(aes(fill=factor(cyl))) + 
  theme(axis.text.x = element_text(angle=65, vjust=0.6)) + 
  labs(title="Box plot", 
       subtitle="City Mileage grouped by Class of vehicle",
       caption="Source: mpg",
       x="Class of Vehicle",
       y="City Mileage")
```

### stat="identity"

```{r Identity, echo = T,message = FALSE, error = FALSE, warning = FALSE}
Cylinder3 <- readRDS(file = "./01_Datasets/Cylinder_Baseline.rds")
library(ggplot2)
ggplot(Cylinder3,aes(x=Subgroup,fill=Treatment))+
  geom_boxplot(aes(lower=`  Mean`-`  SD`,
                   upper=`  Mean`+`  SD`,
                   middle=`  Mean`,
                   ymin=`  Min`,
                   ymax=`  Max`),
               stat="identity")+
  geom_text(aes(label=`P-Value`, x=Subgroup, y=5.5),hjust=0.4)+
  coord_flip() +
  theme_bw() +
  theme(legend.position = "bottom") +
  labs(x = "Subgroups",
       y = "Cylinder [D]",
       title = "Subjective refraction Cylinder at Baseline")


MeanRotation <- readRDS(file = "./01_Datasets/MeanRotation.rds" )
ggplot(MeanRotation, aes(x=Visit,fill=Treatment))+
  geom_boxplot(aes(lower=mean-SD,
                   upper=mean+SD,
                   middle=mean,
                   ymin=min,
                   ymax=max),
               stat="identity")+
  geom_text(aes(label=n, x=Visit, y=mean+1.5), vjust=1.3, color="white",
            position = position_dodge(0.8), size=3.5)+
  geom_text(aes(label=P,colour=label_color, x=Visit, y=25),hjust=0.4, size=3.5,show.legend = FALSE)+
  scale_fill_brewer(palette="Paired")+
  facet_wrap(.~ Subgroup, nrow = 2)+
  coord_flip() +
  theme_bw() +
  theme(legend.position = "bottom") +
  labs(x = "",
       y = "Mean absolute rotation",
       title = "Mean absolute rotation by visit")
```


### Dot + Box Plot 

In addition to the information provided by the box plot, you can provide clearer information in the form of summary statistics for each group. These points are interlaced to make each point represent an observation value.

```{r Dot Box Plot, echo = T,message = FALSE, error = FALSE, warning = FALSE}
# plot
g <- ggplot(mpg, aes(reorder(manufacturer, cty, FUN = median) , cty))
g + geom_boxplot() + 
  geom_dotplot(binaxis='y', 
               stackdir='center', 
               dotsize = .5, 
               fill="red") +
  theme(axis.text.x = element_text(angle=65, vjust=0.6)) + 
  theme_bw() +
  labs(title="Box plot + Dot plot", 
       subtitle="City Mileage vs Class: Each dot represents 1 row in source data",
       caption="Source: mpg",
       x="Class of Vehicle",
       y="City Mileage")
```
### Violin Plot 

The violigogram is similar to the box pattern, but the density of the group is displayed. There is no too much information like a box line map.

```{r geom_violin, echo = T,message = FALSE, error = FALSE, warning = FALSE}
ggplot(mpg, aes(class, cty)) +
  geom_violin() + 
  labs(title="Violin plot", 
       subtitle="City Mileage vs Class of vehicle",
       caption="Source: mpg",
       x="Class of Vehicle",
       y="City Mileage") +
  theme_bw()
```




## Other rendering 

### Annotation

Annotation for Text, Shape

```{r Text and Shape, echo = T,message = FALSE, error = FALSE, warning = FALSE}
# Load dataset from github
data <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/3_TwoNumOrdered.csv", header=T)
data$date <- as.Date(data$date)
data %>%
  ggplot( aes(x=date, y=value)) +
    geom_line(color="#69b3a2")+
    annotate(geom="text", x=as.Date("2017-01-01"), y=19000, 
             label="Bitcoin price reached 20k $\nat the end of 2017")+
    annotate(geom="point", x=as.Date("2017-12-17"), y=20089, size=10, shape=21, fill="transparent")+
    geom_hline(yintercept=5000, color="orange", size=.5)
```


### Text: ggtext

**Markdown in theme elements**

The ggtext package defines two new theme elements, element_markdown() and element_textbox(). Both behave similarly to element_text() but render the provided text as markdown/html. element_markdown() is meant as a direct replacement for element_text(), and it renders text without word wrapping. To start a new line, use the <br> tag or add two spaces before the end of a line.

```{r ggtext, echo = T,message = FALSE, error = FALSE, warning = FALSE}
## remotes::install_github("wilkelab/ggtext")
## install.packages("ggtext")
library("ggtext")
library("tidyverse")
library("glue")

data <- tibble(
  bactname = c("Staphylococcaceae", "Moraxella", "Streptococcus", "Acinetobacter"),
  OTUname = c("OTU 1", "OTU 2", "OTU 3", "OTU 4"),
  value = c(-0.5, 0.5, 2, 3)
)

data %>% mutate(
  color = c("#009E73", "#D55E00", "#0072B2", "#000000"),
  name = glue("<i style='color:{color}'>{bactname}</i> ({OTUname})"),
  name = fct_reorder(name, value)
)  %>%
  ggplot(aes(value, name, fill = color)) + 
  geom_col(alpha = 0.5) + 
  scale_fill_identity() +
  labs(caption = "Example posted on **stackoverflow.com**<br>(using made-up data)") +
  theme(
    axis.text.y = element_markdown(),
    plot.caption = element_markdown(lineheight = 1.2)
  )

```
  
  
### Text: ggrepel

There are two important functions in ggrepel R packages:

* geom_label_repel()
* geom_text_repel()


```{r ggrepel, echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("ggrepel")
## Take a subset of 15 random points
set.seed(1234)
ss <- sample(1:32, 15)
df <- mtcars[ss, ]

## Create a scatter plot:
p <- ggplot(df, aes(wt, mpg)) +
  geom_point(color = 'red') +
  theme_classic(base_size = 10)

## Add text labels:
## Add text annotations using ggplot2::geom_text
p + geom_text(aes(label = rownames(df)),
              size = 3.5)

## Use ggrepel::geom_text_repel
require("ggrepel")
set.seed(42)
p + geom_text_repel(aes(label = rownames(df)),
                    size = 3.5) 

## Change color by groups
p + geom_label_repel(aes(label = rownames(df),
                    fill = factor(cyl)), color = 'white',
                    size = 3.5) +
   theme(legend.position = "bottom")

## With selection
# Data are available in the gapminder package
library(gapminder)
data <- gapminder %>% filter(year=="2007") %>% select(-year)
# prepare data
tmp <- data %>%
  mutate( annotation = ifelse(gdpPercap > 5000 & lifeExp < 60, "yes", "no"))
# plot
tmp %>%
  ggplot( aes(x=gdpPercap, y=lifeExp, size = pop, color = continent)) +
    geom_point(alpha=0.7) +
    theme(legend.position="none") +
    geom_text_repel(data=tmp %>% filter(annotation=="yes"), aes(label=country), size=4 )
```





### Arrage: gridExtra

```{r lay, echo = T,message = FALSE, error = FALSE, warning = FALSE}
## assemble multiple plots on a page is to use the grid.arrange() function
library(gridExtra)
p1 <- qplot(mpg, wt, data = mtcars, colour = cyl)
p2 <- qplot(mpg, data = mtcars) + ggtitle("title")

grid.arrange(p1, p2, nrow = 1)

## Tables and other grobs
grid.arrange(
  tableGrob(mtcars[1:4, 1:4]),
  p2,
  ncol = 2,
  widths = c(1.5, 1),
  clip = FALSE
)
```

### Interactive charts: plotly

```{r interactive, echo = T,message = FALSE, error = FALSE, warning = FALSE}
# load data
library(gapminder)
data <- gapminder %>% filter(year=="2007") %>% select(-year)

# Interactive version
library(plotly)
p <- data %>%
  mutate(myText=paste("This country is: " , country )) %>%
  ggplot( aes(x=gdpPercap, y=lifeExp, size = pop, color = continent, text=myText)) +
    geom_point(alpha=0.7) 

ggplotly(p, tooltip="text")
```



## DiagrammeR

### Basic flowchart using `grViz`

```{r DiagrammeR,echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("DiagrammeR")

grViz("digraph flowchart {
      # node definitions with substituted label text
      node [fontname = Helvetica, shape = rectangle]        
      tab1 [label = '@@1']
      tab2 [label = '@@2']
      tab3 [label = '@@3']
      tab4 [label = '@@4']
      tab5 [label = '@@5']

      # edge definitions with the node IDs
      tab1 -> tab2 -> tab3 -> tab4 -> tab5;
      }

      [1]: 'Questionnaire sent to n=1000 participants'
      [2]: 'Participants responded to questionnaire n=850'
      [3]: 'Participants came to clinic for evaluation n=700'
      [4]: 'Participants eligible for the study n=600'
      [5]: 'Study sample n=600'
      ")

grViz("digraph flowchart {
      # node definitions with substituted label text
      node [fontname = Helvetica, shape = rectangle]        
      tab1 [label = '@@1']
      tab2 [label = '@@2']
      tab3 [label = '@@3']
      tab4 [label = '@@4']
      tab5 [label = '@@5']

      # edge definitions with the node IDs
      tab1 -> tab2;
      tab2 -> tab3;
      tab2 -> tab4 -> tab5
      }

      [1]: 'Questionnaire sent to n=1000 participants'
      [2]: 'Participants came to clinic for evaluation n=700'
      [3]: 'Participants non-eligible for the study n=100'
      [4]: 'Participants eligible for the study n=600'
      [5]: 'Study sample n=600'
      ")
```

### Graphviz Attributes
 
* Node Attributes
* Edge Attributes
* Colors
* Node Shapes
* Arrow Shapes

See more under `Graphviz and mermaid in DiagrammeR`




```{r Graphviz-Attributes,echo = T,message = FALSE, error = FALSE, warning = FALSE}
grViz("digraph {
graph [layout = dot, rankdir = LR]
# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

data1 [label = 'Dataset 1', shape = folder, fillcolor = Beige]
data2 [label = 'Dataset 2', shape = folder, fillcolor = Beige]
process [label =  'Process \n Data']
statistical [label = 'Statistical \n Analysis']
results [label= 'Results']

# edge definitions with the node IDs
{data1 data2}  -> process -> statistical -> results
}")
```

### Subgraphs and clusters

We can use subgraphs and clusters to demonstrates groups within the data.


```{r Gantt-chart,echo = T,message = FALSE, error = FALSE, warning = FALSE}
grViz("digraph G{
rankdir=LR
graph[bgcolor = "#FDFDFD"]
edge[style=invis]
node[fontname = "helvetica", width = 1.5, height = 0.5, fontsize=12]
	
    subgraph cluster_accepted {
    node [shape=box,style=filled, fillcolor = red];
    label = '@@1';
    style=dashed;
		color= "#625a5a";
        fontname = "helvetica-bold";
        
		node [shape=box, style=filled, color=black, fillcolor = "#91cf60"];
		    a0[label = 'Approved']
        a1[label = "Awaiting \n Construction"]
        a2[label = "Decommissioned"]
        a3[label = "Operational"]
        a4[label = "Under \n Construction"]
        a5[label = "No Application \n Required"]
        
        a0 -> a2
        a1 -> a5

	}
  
    subgraph cluster_submitted {
    node [shape=box, style = filled, color=black, fillcolor = "#fee08b"];
		label = '@@2';
        style=dashed;
		color= "#625a5a";

        fontname = "helvetica-bold";
        
		s0[label = "In Planning"]
        s1[label = "Connection \n Applied For"]
        s3[style=invis]
        s4[style=invis]
        
}
    
	subgraph cluster_rejected {
    node [shape=box, style = filled, color=black, fillcolor = "#fc8d59
"];
		label = '@@3';
        style=dashed;
        fontname = "helvetica-bold";
        color="#625a5a"
                
		b0[label = "Refused"]
        b1[label = "Withdrawn"]
        b2[label = "No Application \n Made"]
        b3[label = "Abandoned"];
        }
a2 -> s0 -> b0
}")
```


### Gantt chart

```{r Gantt-chart,echo = T,message = FALSE, error = FALSE, warning = FALSE}
# Define the Gantt chart and plot the result (not shown)
mermaid("gantt
        Section Initiation
        Planning           :a1, 2016-01-01, 10d
        Data processing    :after a1, 30d
        Data analysis      :b1, 2016-03-01, 15d")
```


<!--chapter:end:07-ggplot2.Rmd-->


# Proc Sqplot (In Processing)

Placeholder


## ODS
## Introduction
## Scatter Plot
### Vector in scatter Plot
### Add predict curve
### grouping
## Bar chart
### Group and using freq
## Histogram

<!--chapter:end:08-Proc-Sqplot.Rmd-->


# Descriptive Statistics in SAS

Placeholder


## PROC FREQ
### ODS Table Names
### ODS Plots
## PROC UNIVARIATE
### HISTOGRAM Statement
### CDFPLOT Statement
### PPPLOT Statement
### PROBPLOT and QQPLOT Statement
### ODS Tables   
### ODS Graphics
## PROC MEANS
### Basic summary statistics
### AUTONAME Option
### CHARTYPE Option
## PROC TABULATE 
### Basic Syntax for PROC TABULATE
### Identification of Desired Statistics
### In processing

<!--chapter:end:10-Descriptive-Statistics-in-SAS.Rmd-->


# Descriptive Statistics in R

Placeholder


## Package pape 
## Package summarytools 
## Package compareGroups  
## Package sjPlot for Models Summary
## Package kableExtra 
### kable_styling
### Column/Row Specification
### Grouping columns/rows 
### Add Footnote

<!--chapter:end:11-Descriptive-Statistics-in-R.Rmd-->


# Sample Size Calculation

Placeholder


## Distribution
### Quantile Function in SAS
### Binomial distribution
### Negative binomial distribution
### Multinomial distribution
### Normal Distribution
### Multivariate normal distribution
### Poisson distribution
### Exponential distribution
### Gamma distribution
### Weibull Distribution
### Beta Distribution
#### Beta分布及其函数公式推导
#### Beta 函数和 Gamma 函数
#### Beta 分布的期望与方差
## Point Estimates
## Test Proportion(s)
### Binomial CI for Small Samples
#### Wald CI
#### Clopper-Pearson or “Exact” CI
#### Wilson score CI
#### Adjusted Wald CI
### Package binom
### %CI_Single_Proportion 
### Incidence rate CI
### Package: pwr
### 1-Sample Proportion, 2-Sided Equality based on Wald CI
### 1-Sample Proportion Non-Inferiority or Superiority
### 1-Sample Proportion Equivalence
### 2-Sample Proportions, 2-Sided Equality based on Wald CI
### 2-Sample Proportions Non-Inferiority or Superiority
### 2-Sample Proportions Equivalence
### Paired Proportions: McNemar's Z-test
### Chi-square test
## Test Mean(s)
### One Sample Mean 2-Sided Equality
### 1-Sample Mean Non-Inferiority or Superiority
### 1-Sample Mean Equivalence
### 2-Sample Means, 2-Sided Equality
### 2-Sample Means, 1-Sided
### 2-Sample Means Non-Inferiority or Superiority
### 2-Sample Means Equivalence
### T-Test using `pwr.t.test` or `pwr.t2n.test`
### Test k Means
### Anova using `pwr.anova.test`
### Average Bioequivalence
## Other Methods
### Odds Ratio
### Correlation
### Correlated Binary Data: Ophthalmologic Studies
## Multiple test
### Definitions of Power 
### Bonferroni Tests (Individual Power)
### Tukey's method (Individual Power)
### Dunnett's Two-Sided Tests (Individual Power)
### Combined Power %SimPower and %PlotSimPower
#### **All Pairwise Comparisons**
#### **logically constrained step-down tests**
#### **DUNNETT Comparisons with a Control Two-Sided**
#### **Step-down Dunnett**
### Dunnett Set up Close Tests in R
## Time-To-Event Data
### Cox PH, 2-Sided Equality
### Log-Rank Tests for Competing Risks
## Estimation in diagnostic test 
### Adequate sensitivity/specificity
### Testing sensitivity (or specificity) 
### Likelihood ratio estimation
### ROC index of accuracy

<!--chapter:end:13-Sample-Size.Rmd-->


# Parametric Test

Placeholder


## Binomial test
### Mathematical Formula
### R implementation
### SAS Implementation
## Fisher's Exact Test
### Introduction
### SAS implementation
### R implementation
## McNemar's test
### introduction
### SAS Implementation
### R Implementation
## Cochran–Mantel–Haenszel Test
### R implementation
## Correlation Test
### Pearson correlation 
### Spearman correlation
### Kendall correlation
## Two Sample T-Test
### Inreoduction
### SAS implementation
### R implementation
## Normality test
### SAS implementation
### R implementation

<!--chapter:end:14-Parametric-Test.Rmd-->


# ANOVA

Placeholder


## Unstructured Models
## Balanced One-Way Analysis-of-Variance (ANOVA) 
### Modeling Assumptions and Basic Analysis
### Parameter Estimates
### R Implementation
### SAS Implementation
### Model Diagnosis
#### Homogeneity Test
#### Normality assumption
#### Violation of assumptions
## Unbalanced One-Way ANOVA and Analysis-of-Covariance (ANCOVA)
## Two-Ways ANOVA Test
### Introduction
### R implementation
### SAS Implementation
### Unbalanced design
## Heteroscedastic Responses
## Repeated Measures ANOVA Data 
## Multivariate Responses with Normally Distributed Data 
## Independent Observations from Parametric Nonnormal Distributions
## Dependent Observations from Parametric Nonnormal Distributions

<!--chapter:end:15-ANOVA.Rmd-->


# Multiple-Comparison

Placeholder


## Introduction
### Multiplicity Problem
### Error Rates
#### Comparisonwise Error Rate (CER)
#### Familywise Error Rate (FWE) 
#### Control of the FWE: Weak and Strong
#### Directional Decisions and Type III Error Rates
#### False Discovery Rate (FDR)
### The adjusted P
### Basic Statistical Concepts
### Functions in glht package in R
## Bonferroni and Šidák Methods
### LSD (least significance difference)
### Šidák
### Bonferroni
### Schweder-Spjøtvoll p-Value Plot 
## MCP among Treatment Means in the One-Way Balanced ANOVA 
### LS-Means    
### The Multivariate t Distribution
### Calculating the Critical Value $c_{\alpha}$
### All Pairwise Comparisons and Studentized Range Distribution
### Tukey's Method for All Pairwise Comparisons
### Displaying Pairwise Comparisons Graphically
### Dunnett's Two-Sided Comparisons with a Control and Dunnett's Two-Sided Range Distribution
### Dunnett's One-Sided Comparisons with a Control
### Maximum Modulus Distribution, Multiple Inferences for Independent Estimates
## Multiple Comparisons among Treatment Means in the One-Way Unbalanced ANOVA 
### The Model and Estimates
### Tukey-Kramer Method 
### Alternative Simulation-Based Method
### Pairwise Comparisons with Control 
### Comparisons with the Average Mean–Analysis of Means (ANOM) 
## Generalizations for the Analysis of Covariance (ANCOVA) model
### Dunnett-Hsu Factor Analytic Approximation 
### Hsu-Nelson Simulation-Based Approximation: CVADJUST Method
### Comparisons in ANCOVA Models with Interaction 
## Multiple Inferences for Infinite Sets of Parameters
### Scheffés Method
### Finding the Maximal Contrast
### Working-Hotelling method
### Discrete approximation method
## Multiple Comparisons under Heteroscedasticity 
### Introduction of heteroscedasticity
### Satterthwaite Approximation 
### MaxT Method under Heteroscedasticity
### MinP Method under Heteroscedasticity
## Closed and Stepwise Testing Methods 
### Closed Family of Hypotheses
### Bonferroni-Holm Method 
### Šidák-Holm Method 
### Closed Fisher Combination Method 
### Simes-Hommel Method 
### Hochberg’s O(k) Step-Up
### Sequential Testing with Fixed Sequences 
### Sequential Testing Using Gatekeeping Methods
## Closed Testing of Pairwise Comparisons and General Contrasts
### Incorporating Logical Constraints
### Shaffer’s Method
### Extended Shaffer-Royen Method 
### Step-down Dunnett test
## Multiple Comparisons with Binary Data
### Introduction
### Multivariate Two-Sample Binary Outcomes

<!--chapter:end:16-Multiple-Comparison.Rmd-->


# Non-Parametric Test

Placeholder


## Two Samples Hypotheses Testing
### Sign Test for Location Parameter for Matched Paired Samples
### Wilcoxon Signed-Rank Test for Location Parameter for Matched
### Wilcoxon Rank-Sum Test for Location Parameter for Two Independent Samples
### Ansari-Bradley Test for Scale Parameter for Two Independent Samples
### Kolmogorov-Smirnov Test for Equality of Distributions
## Several Samples Hypotheses Testing
### Friedman Rank Test for Location Parameter for Several Dependent Samples
### Kruskal-Wallis H-Test for Location Parameter
## Tests for Categorical Data
### Spearman Rank Correlation Coefficient Test
### Fisher Exact Test
## Permutation test
### Introduction
### Package: coin
### One-way Permutation Test of Independence for Ordinal Data
### One-way Permutation Test of Symmetry for Ordinal Data
### Permutation Tests for Medians and Percentiles
## Nonparametric Regression

<!--chapter:end:17-Non-Parametric-Test.Rmd-->


# Correlation and Regression

Placeholder


## Correlation
### Pearson correlation coefficient 
### Spearman's rank correlation coefficient 
### Kendall rank correlation coefficient
### Intraclass correlation
### Visualize the correlation in R
## Ordinary least squares (OLS) 
### Assumpions
### Interpretation
### Matrix Solution
### Gauss-Markov Theorem
### limitation
## Model Statistics
### Residuals Standard Error
### R-Squared and Adjusted R-Squared
### T Statistic  
### F Statistic
### Confidence Intervals 
### Likelihood-ratio test
### Accuracy
## Model Diagnostics
### Checking Error Assumptions
### Finding Unusual Observations
### Checking the Structure of the Model
## SAS implementation Proc Reg
### Options
### Diagnose
## R implementation 

<!--chapter:end:18-Regression.Rmd-->


# Advanced Linear Regression

Placeholder


## Model Selection
### Selection Methods
### Selection Criteria
### k- Fold Cross validation
## Practical Difficulties using OLS
## Skewness
### Introduction
### Baisc Transformation  
### Box-Cox Power Transformation
## Scale
## Interaction
### Simple slopes analysis
### Plotting Interactions 
### Check linearity assumption
## Collinearity
## Problems with the Error
### Generalized Least Squares
### Weighted Least Squares
### Robust Regression
## Shrinkage Methods
### Principal Components Analzsis
### Partial Least Squares
### Ridge Regression

<!--chapter:end:19-Advanced-Linear-Regression.Rmd-->


# Logistic Regression 

Placeholder


## Introduction
### Violation of assumptions of Ordinary least squares (OLS) 
### More fundamental problem outside [0,1]
### Logistic Regression Model 
### Estimation of the Logistic Model
### Convergence Problems
### Use exact methods. 
### Use penalized likelihood
## Logit Modell
### Introduction
### R Implementation
### SAS Implementation
### Multicollinearity
### Goodness-of-Fit Statistics Pearson deviance
### Hosmer and Lemeshow Goodness-of-Fit Test
### Statistics Measuring Predictive Power $R^2$
#### Generalized $R^{2}$
#### McFadden $R^{2}$
#### Tjur's $R^{2}$
### ROC Curves 
### Predicted Values, Residuals, and Influence Statistics
### Unobserved Heterogeneity
### Plotting Effects of Predictor Variables
## Probit Modell
### Introduction
### R Implemetation
### SAS Implementation
## Complementary log-log-Modell
### R Implemetation
## Multi-category logit model
### Multinomialverteilung
### Mehrkategoriales Logit-Modell
### R Implementation
### SAS Implementation
## Ordinal Cumulative Logit Model
### R Implementation
### SAS Implementation
## Adjacent Categories Model
## Continuation Ratio Model

<!--chapter:end:20-Logistic-Regression.Rmd-->


# Advanced Logistic Regression  

Placeholder


## Logit Analysis of Contingency Tables
### Two-Way Table
### Three-Way Table
### Four-Way Table
### Overdispersion
## Loglinear Analysis of Contingency Tables
### Two-way Table
### Problem of Zeros
## Discrete Choice Analysis
### Logistic Strata
### Conditional logit model
### Ranked Data
### Heteroscedastic extreme value (HEV) Model
### Nested logit model
## Longitudinal and Other Clustered Data
### Introduction
### Robust Standard Errors
### GEE Estimation with PROC GENMOD
### Mixed Models with PROC GLIMMIX
### Fixed-Effects with Conditional Logistic Regression
### Hybrid Method      

<!--chapter:end:21-Advanced-Logistic-Regression.Rmd-->


# Survival Analysis 

Placeholder


## Preliminary
### Probability density function
### Cumulative distribution function
### Survival function
### Hazard function
### Cumulative hazard function
### Mean Residual Life
### Relation between functions
## Kaplan-Meier estimator
### KM Introduction
### Nelson-Aalen estimator of the cumulative hazard function
### Survival curve in SAS
### KM Survival Plots in SAS
### Convert Personal-level to Personal-period in R
### Package survfit in R
### KM Survival Plots in R
## Compare the survival function
### Tests of equality of the survival function
### Other nonparametric tests for STRATA statement 
### Multiple comparisons
### Comparing survival functions using Log-Rank HR
### Mantel-Haenszel HR
## Cox Proportional Hazards Model
### Introduction

<!--chapter:end:22-Survival-Analysis.Rmd-->

# Advanced Survival Analysis 

<!--chapter:end:23-Advanced-Survival-Analysis.Rmd-->


# Count Data Regression  

Placeholder


## Introduction of Count Data Regression  
## Poisson regression
## Negative Binomial Regression
## Zero-truncated Poisson Regression Model 
## Zero-Insflated Model
## Hurdle models
## Proportion-Response-Regression
### Beta Regression
### Zero-inflated Beta Regression
### One-inflated Beta Regression
### Zero-one-inflated Beta Regression

<!--chapter:end:24-Count-Data-Regression.Rmd-->


# Mixed Model 

Placeholder


## Introduction
### Correlated response data
### Hierarchical and Marginal model
### MLE in Marginal model
### REML in Marginal model
### Variance correction
#### Kackar-Harville correction
#### Kendward-Roger correction
### Hypothesis tests
#### Wald Test
#### Likelihood Ratio Test
### Residual Structure
### Converge problems
## Random Slope and Intercept Model  
### Model Introduction
### SAS Implementation
### R Implementation
#### Model with one random intercept effekct
#### Model with random intercept and slpoe effects
## Random Slope and Intercept Model with Covariance Structure
### Model Introduction
### SAS Implementation
### R Implementation
## Generalized Estimating Equation  
### Introduction of GEE
### SAS Implementation 
### R Implementation 
## Hierarchical Regression Model for Normal Response
### Introduction
### SAS Implementation  
### R Implementation  

<!--chapter:end:26-Mixed-Model.Rmd-->

# Generalized Linear (Mixed) Model 

<!--chapter:end:27-GLM-and-GLMM.Rmd-->


# Meta Analysis 

Placeholder


## Introduction
### meta-analysis for different data
## Fixed Effect Model for Continuous Outcomes
### Effect Measures  
### Standardized Mean Difference
### Inverse variance-weighted average method
### Generic inverse variance meta-analysis `metagen`
### Weighted Sum of Z-Scores
## Random Effects Model for Continuous Outcomes
### Introduction
### Implementation
### Hartung-Knapp Adjustment
## Meta-Regression
## Meta-Analysis with Binary Outcomes
### Effect Measures
#### Odds Ratio
#### Risk Ratio
#### Risk Difference
#### Arcsine Difference
### Implementation
### Estimation in Sparse Data - Continuity correction
### Peto Odds Ratio
### Fixed Effect Model: Inverse Variance Method
### Fixed Effect Model: Mantel–Haenszel Method
### Random Effects Model

<!--chapter:end:30-Meta-Analysis.Rmd-->


# Group (Adaptive) Sequential Design 

Placeholder


## Classical Designs without futility stopping
### Pocock Method
### O'Brien & Fleming Method
### Wang & Tsiatis Method
### Rejection bounds and Local p-values
### Power and Sample size
## Classical Designs with binding futility stopping
### Symmetric designs
### One-Sided Designs
## Alpha Spending Function Approach
## R Implementation using rpact
### Basic Functions
### `getDesignGroupSequential` defining efficacy boundaries
### `futilityBounds` defining futility boundaries
## Sample Size
### Sample Sizes for Different Types of Endpoints without IA
### Two groups continuous endpoint (without IA)
### Two groups binary endpoint (without IA)
### Group-sequential designs for conti and binary
### Survival endpoint
#### Specifying survival distributions
#### Without interim analyses

<!--chapter:end:31-Group-Sequential-Design.Rmd-->


# Adaptive designs

Placeholder


## Introduction
### Early termination due to futility
### Early termination due to efficacy
### Sample size reassessment
### Change or modification of the primary endpoint 
### Discontinuing treatment arms 
### Switching between superiority and non-inferiority
### Selection of the patient population 
### Methods
##  General Theory
### Stopping Boundary
### Power and Adjusted p-value
### Stopping Probabilities (Design Evaluation)
### Expected Duration of an Adaptive Trial (Design Evaluation)
### Expected Sample Sizes (Design Evaluation)
### Conditional Power and futility index
## Method with Direct Combination of p-values
### Method Based on Individual p-values
### Method Based on the Sum of p-values
### Method with Product of p-values
### Fisher’s product test (Combination Tests)
### Fisher’s product test with early rej. and acceptance
## Inverse normal combination function

<!--chapter:end:32-Adaptive-Design.Rmd-->

# Propensity Score 

<!--chapter:end:33-Propensity-Score.Rmd-->


# Missing Data

Placeholder


##  Missing mechanisms
## Compatibility and Congeniality
## Single imputation
## Multiple imputation
### Joint Modeling (JM)
### Multiple Imputation by Fully Conditional Specification (MICE)
## Bayesian linear regression
## Predictive Mean Matching
## MICE using random forest

<!--chapter:end:34-Missing-Data.Rmd-->

`r if (knitr:::is_html_output()) '
# References {-}
'`

<!--chapter:end:40-references.Rmd-->

