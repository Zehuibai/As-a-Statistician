# Input and Format

```{r mind map,echo = F,message = FALSE, error = FALSE, warning = FALSE}
library('mindr')
### text -> widget
### input <- c("# Chapter 1", "## Section 1.1", "### Section 1.1.1", "## Section 1.2", "# Chapter 2")
### mm(from = input, type = "text", root = "mindr")
filename <- rstudioapi::getSourceEditorContext()$path
widget <- mm(from = filename, type = "file", root = "")
widget
```

## Input data into SAS

### Reading free formatted data instream

```
DATA data1;
 INPUT make $ model $ mpg weight price;
CARDS;
AMC Concord 22 2930 4099
AMC Pacer   17 3350 4749
AMC Spirit  22 2640 3799
Buick Century 20 3250 4816
Buick Electra 15 4080 7827
;
RUN; 
```

### Reading fixed formatted data instream

It need to provide the beginning and ending column numbers for each variable.
 
```
DATA data2;
  INPUT make $ 1-5 model $ 6-12 mpg 13-14 weight 15-18 price 19-22;
CARDS;
AMC  Concord2229304099
AMC  Pacer  1733504749
AMC  Spirit 2226403799
BuickCentury2032504816
BuickElectra1540807827
;
RUN;
```

### INFILE: Reading fixed formatted data from an external file

```
The data3.dat file:

AMC  Concord2229304099
AMC  Pacer  1733504749
AMC  Spirit 2226403799
BuickCentury2032504816
BuickElectra1540807827 

DATA cars3;
  INFILE "~/path/data3.dat";
  INPUT make $ 1-5 model $ 6-12 mpg 13-14 weight 15-18 price 19-22;
RUN;

*** with special (comma) delimited
*** tab delimited: DELIMITER='09'x;
*** comma delimited: delimiter=',';

AMC,Concord,22,2930,4099
AMC,Pacer,17,3350,4749
AMC,Spirit,22,2640,3799
Buick,Century,20,3250,4816
Buick,Electra,15,4080,7827 

DATA cars5;
  INFILE "~/path/data3.dat"  delimiter=',';
  INPUT make $ model $ mpg weight price;
RUN;
```

### Write the SAS File

```
libname diss 'c:dissertation';
 
data diss.salary;
  input sal1996-sal2000 ;
  cards;
10000 10500 11000 12000 12700
14000 16500 18000 22000 29000
;
run;

data 'c:dissertationsalarylong';
  input Salary1996-Salary2000 ;
cards;
10000 10500 11000 12000 12700
14000 16500 18000 22000 29000
;
run;
```


### Import csv data

```
PROC IMPORT  datafile="Z:\path\data4.csv"
        out=outname
        dbms=csv
		replace;
		delimiter=";";
        getnames=yes;
		Guessingrows=MAX;
RUN;
```

### %Import

Import all SAS datasets available in a specific folder

| Macro Variables | Description                                                                                                            |
|-----------------|------------------------------------------------------------------------------------------------------------------------|
| folder_path     | File path with the data that are to be imported;                                                                       |
| delete_all      | If delete_all is unequal 1 then all datasets in the work-library are deleted, else if it is 1 no datasets are deleted; |
| fname&i         | Macro variable that contains the dataset name                                                                          |
| total           | Number of all datasets within a folder                                                                                 |


```
%macro Import (folder_path, delete_all);
	*** delete all datasets if delete_all is 1;
	%if &delete_all ne 1 %then %do;
		proc datasets library=work kill nolist; run; quit;
		dm log 'clear';
	%end;

	libname IMPORT "&folder_path";

	*** definition of folder with the datasets;
	proc sql;
		create table m_dataset_list as select distinct memname from dictionary.tables
		where libname="IMPORT" and memtype="DATA";
	quit;

	*** declare macro variables containing the name of a dataset in the specified folder and their overall number; 
	data m_dataset_list;
		set m_dataset_list end=last;
		retain i 0;
		i=i+1;
		call symput('fname'||trim(left(put(i,8.))),scan(trim(memname),1,'.'));
		if last then call symput('total',trim(left(put(i,8.))));
	run;


	*** import by means of the macro variables defined above ; 
	libname libdata "&folder_path";
	libname library (libdata); 	
	%do i=1 %to &total;
		data work.&&fname&i; set libdata.&&fname&i; 
		run;
	%end;
%mend Import;

%Import (folder_path=Z:\...\,
		 delete_all=);
```

### Infile Read multiple raw data files

```
* data step to read in data;
data mydata;
  length inname $ 100;
  input inname $;

  infile dummy filevar=inname end=EOF;
  do until (EOF);

    * PUT YOUR INPUT STATEMENT HERE TO READ IN YOUR DATA;
    input year 1-4 name $ 6-28 party $ 30-34 born 35-38 died 40-43
          age 45-46 stborn $ 48-49 stelec $ 51-52 religion $ 54-65
          elecvote 67-69 popvote 71-78;

    * DO ANY PROCESSING OF THE DATA HERE (E.G. COMPUTING NEW VARIABLES);
    output;
  end;
cards;
c:winners1.txt
c:winners2.txt
run;
```

### Generate automatic file name

If you create multiple data sets in SAS, you may want to name them in an automated way. How to create a file name based on date and time. Such a file naming process will 1) prevent you from providing the same file name to two different data sets, and 2) allow you to see when the file was first created.

```
data tsave;
  do i = 1 to 10;
    do time = 1 to 5;
	   y = rannor(1232+i + time);
       output;
  	end;
  end;
run;

data _null_;
  cdate =  "&SYSDATE9";
  ctime = "&SYSTIME";
  time_string = cdate||"_"||translate(ctime, "_", ":");
  call symput('mytime', time_string);
run;

data "c:tempnewdata_&mytime";
  set tsave;
run;
```


## Input and import data in R

### Import csv data

The Scan function returns a **list or vector**. This makes the scanning function less useful for entering "rectangular" data

```
mydata1 <- read.csv("~/Desktop/SASUniversityEdition/myfolders/Daten/CRP.csv",
                    sep=";", 
                    header=TRUE)   
mydata2 <- scan("~/Desktop/SASUniversityEdition/myfolders/Daten/CRP.csv", 
                sep=";", 
                what = list("integer","numeric"))
```

### Import txt data

```
test.semi <- read.table("https://stats.idre.ucla.edu/wp-content/uploads/2016/02/testsemicolon.txt", header=T, sep=";")
print(test.semi)

pfad <- "~/Desktop/SASUniversityEdition/myfolders/Daten"
mydata3 <- read.table(file.path(pfad, "CRP.csv"), 
                      header=TRUE, sep=";", dec = ",", skip=9) 
```

### Import excel data

* read.xlsx slow for large data sets (worksheet with more than 100 000 cells)  
* read.xlsx2 is faster on big files compared to read.xlsx function.

```
## install.packages("xlsx")
library("xlsx")
read.xlsx(file, sheetIndex, header=TRUE, colClasses=NA)
read.xlsx2(file, sheetIndex, header=TRUE, colClasses="character")
```

### Import stata data

```
library(foreign)
test.stata <- read.dta("https://stats.idre.ucla.edu/stat/data/test.dta")
print(test.stata)
```

### Import SAS data

```
library(sas7bdat)
data <- read.sas7bdat("~/Desktop/SASUniversityEdition/myfolders/Daten/uis.sas7bdat")
View(data)
```

### Copy from clipboard

```
copdat <- read.delim("clipboard")
yourdata <- copdat 
```

## Save and write objective in R

### Save as R-Datei

```
path <- "C:/Users/zbai/Projects/00_Project/00 PMS_VENUS/VENUS_CIR/01_Datasets"
saveRDS(save_objective, file = file.path(path, "dataname.rds" ))

save_objective <- readRDS(file = file.path(path, "dataname.rds" ))
```

### write.table and write.csv

```
#  quote：字符串是否使用引号表示，默认为TRUE，也就是使用引号表示
#  row.names：是否导出行序号，默认为TRUE，也就是导出行序号 
#  col.names：是否导出列名，默认为TRUE，也就是导出列名 
#  sep：分隔符，默认为空格（” “），也就是以空格为分割列
write.table (data ,file ="~/Desktop/f.csv", row.names = FALSE, col.names =FALSE, quote =FALSE)
```

### write.foreign

Save as SPSS- und SAS- Datei 

```{r write as SAS- Datei,echo = T,message = FALSE, error = FALSE, warning = FALSE}
library("foreign")
datafile <- tempfile()
codefile <- tempfile()
write.foreign(esoph, datafile, codefile, package="SAS")
file.show(datafile)
file.show(codefile)
unlink(datafile)
unlink(codefile)
```

### write.xlsx

```
# Write the first data set in a new workbook
write.xlsx(USArrests, file = "./01_Datasets/myworkbook.xlsx",
      sheetName = "USA-ARRESTS", append = FALSE)
# Add a second data set in a new worksheet
write.xlsx(mtcars, file = "myworkbook.xlsx", 
           sheetName="MTCARS", append=TRUE)
# Add a third data set
write.xlsx(iris, file = "myworkbook.xlsx",
           sheetName="IRIS", append=TRUE)
```





### Save the plot

File formats for exporting plots:

* pdf(“rplot.pdf”): pdf file
* png(“rplot.png”): png file
* jpeg(“rplot.jpg”): jpeg file
* postscript(“rplot.ps”): postscript file
* bmp(“rplot.bmp”): bmp file
* win.metafile(“rplot.wmf”): windows metafile

```
# 1. Open a pdf file
pdf("rplot.pdf") 
# 2. Create a plot
plot(x = my_data$wt, y = my_data$mpg,
     pch = 16, frame = FALSE,
     xlab = "wt", ylab = "mpg", col = "#2E9FDF")
# 3. Close the pdf file
dev.off() 
```


## Format in SAS

### Proc format 

```
proc format;
    value eye_CAT    1 = "OD"
	                   2 = "OS";
	  value AR_CAT     1 = "^{unicode 2264} 3° absolute rotation"
	                   2 = "^{unicode 2264} 5° absolute rotation"
									   3 = "^{unicode 2264} 7° absolute rotation"
								     4 = "^{unicode 2264} 10° absolute rotation"
								     5 = "^{unicode 2264} 20° absolute rotation"
								     6 = "^{unicode 2264} 30° absolute rotation";
run;
```

### Copy and combine SAS format libraries

```
libname first "etempdata1";
libname second "etempdata2";

proc catalog cat=first.FORMATS;
  copy out=second.FORMATS;
run;
```

## Package readr 

## Package Strings

## Package forcats

## Package lubridate
