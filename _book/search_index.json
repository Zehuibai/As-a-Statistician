[["ggplot2.html", "Chapter 7 ggplot2 7.1 Parametric Rendering 7.2 Scatter plot 7.3 Histogram 7.4 Bar plot 7.5 Box Plot 7.6 Text rendering", " Chapter 7 ggplot2 7.1 Parametric Rendering 7.1.1 Grammar ggplot2 implements the idea of a grammar of graphics. The grammar implemented by ggplot2 could be summarized as follows: plot ::= coord scale+ facet? layer+ layer ::= data mapping stat geom position? A plot is defined by a coordinate system (coord), one or more scales (scale), an optional faceting specification (facet), and one or more layers (layer). A layer is defined as an R data frame (data), a specification mapping columns of that frame into aesthetic properties (mapping), a statistical approach to summarize the rows of that frame (stat), a geometric object to visually represent that summary (geom), and an optional position adjustment to move overlapping geometric objects out of their way (position). 7.1.2 coord coord_cartesian - (default) cartesian coordinate system (x horizontal from left to right, y vertical from bottom to top) coord_flip - flipped cartesian coordinate system (x vertical from bottom to top, y horizontal from left to right) coord_trans coord_equal coord_polar - polar coordinate system; the x (or y) scale is mapped to the angle (theta) coord_map - various map projections 7.1.3 facet facet_wrap(~cell) - univariate: create a 1-d strip of panels, based on one factor, and wrap the strip into a 2-d matrix facet_grid(row~col) - (usually) bivariate: create a 2-d matrix of panels, based on two factors 7.1.4 geom geom Useful stats (default in bold) Default position adjustment Parameters (when used with given stat) blank identity identity no parameters abline abline identity slope, intercept, size, linetype, colour, alpha identity identity slope, intercept, size, linetype, colour, alpha hline hline identity yintercept, size, linetype, colour, alpha identity identity y, yend, size, linetype, colour, alpha vline vline identity xintercept, size, linetype, colour, alpha identity identity x, xend, size, linetype, colour, alpha text identity identity x, y, label, size, colour, alpha, hjust, vjust, parse point identity identity x, y, size, shape, colour, fill, alpha, na.rm jitter identity jitter x, y, size, shape, colour, fill, alpha, na.rm segment identity identity x, xend, y, yend, size, linetype, colour, alpha, arrow line identity identity group, x, y, size, linetype, colour, alpha, arrow bar identity stack x, y, size, linetype, colour, fill, alpha, weight(?) ??? bin stack x, y, size, linetype, colour, fill, alpha, weight(?) ??? histogram alias for geom_bar area identity stack group, x, y, size, linetype, colour, fill, alpha, na.rm ribbon identity identity group, x, ymin, ymax, size, linetype, colour, fill, alpha, na.rm linerange identity identity x, ymin, ymax, size, linetype, colour, alpha pointrange identity identity x, y, ymin, ymax, size, shape, linetype, colour, fill, alpha errorbar identity identity x, ymin, ymax, size, linetype, colour, alpha, width errorbarh identity identity x, xmin, xmax, y, size, linetype, colour, alpha, height crossbar identity identity x, y, ymin, ymax, size, linetype, colour, fill, alpha, width, fatten boxplot identity dodge x, ymin, lower, middle, upper, ymax, size, colour, fill, alpha, weight(?), width(?), outliers(?), outlier.size, outlier.shape, outlier.colour ??? boxplot dodge x, ymin, lower, middle, upper, ymax, size, colour, fill, alpha, weight(?), width(?), outliers(?), outlier.size, outlier.shape, outlier.colour ??? path identity identity group, x, y, size, linetype, colour, alpha, na.rm, arrow, linemitre, linejoin, lineend polygon identity identity group, x, y, size, linetype, colour, fill, alpha rect identity identity xmin, xmax, ymin, ymax, size, linetype, colour, fill, alpha rug identity identity x, y, size, linetype, colour, alpha step identity identity group, x, y, size, linetype, colour, alpha, direction bin2d identity identity xmin, xmax, ymin, ymax, size, linetype, colour, fill, alpha, weight(?) ??? bin2d identity xmin, xmax, ymin, ymax, size, linetype, colour, fill, alpha, weight(?) ??? tile identity identity x, y, size, linetype, colour, fill, alpha hex identity identity x, y, size, colour, fill, alpha binhex identity x, y, size, colour, fill, alpha density identity identity group, x, y, size, linetype, colour, fill, alpha, weight(?) ??? density identity group, x, y, size, linetype, colour, fill, alpha, weight(?) ??? density2d identity identity group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ??? density2d identity group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ??? contour identity identity group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ??? contour identity group, x, y, size, linetype, colour, alpha, weight(?), na.rm, arrow, linemitre, linejoin, lineend ??? freqpoly identity identity group, x, y, size, linetype, colour, alpha, weight(?) ??? bin identity group, x, y, size, linetype, colour, alpha, weight(?) ??? quantile identity identity group, x, y, size, linetype, colour, alpha, na.rm, arrow, linemitre, linejoin, lineend quantile identity group, x, y, size, linetype, colour, alpha, weight, quantiles, formula, xseq, method, na.rm, arrow, linemitre, linejoin, lineend smooth identity identity group, x, y, ymin, ymax, size, linetype, colour, fill, alpha smooth identity group, x, y, size, linetype, colour, fill, alpha, weight 7.1.5 position position_identity - default of most geoms position_jitter - default of geom_jitter position_dodge - default of geom_boxplot position_stack - default of geom_bar==geom_histogram and geom_area position_fill - useful for geom_bar==geom_histogram and geom_area 7.1.6 scale size - size of a geom shape - shape of a geom linetype - type of a geoms outline (e.g., dashed, dotted) colour - color of a geoms outline fill - color of a geoms fill alpha - transparency of a geom (0=transparent  1=opaque) Functions that ggplot2 provides to define each of the above kinds of scales. x (or y) position scale_x_continuous scale_x_date scale_x_datetime scale_x_discrete size scale_size_continuous scale_area scale_size_discrete scale_size_identity scale_size_manual shape scale_shape_discrete scale_shape_identity scale_shape_manual linetype scale_linetype_discrete scale_linetype_identity scale_linetype_manual colour (or fill) scale_colour_gradient scale_colour_gradient2 scale_colour_gradientn scale_colour_hue scale_colour_brewer scale_colour_grey scale_colour_identity scale_colour_manual alpha scale_alpha_continuous 7.1.7 stat stat_abline - used by geom_abline stat_bin - used by geom_bar == geom_histogram, and geom_freqpoly stat_bin2d - used by geom_bin2d stat_binhex - used by geom_hex stat_boxplot - used by geom_boxplot stat_contour - used by geom_contour stat_density - used by geom_density stat_density2d - used by geom_density2d stat_ecdf stat_function stat_hline - used by geom_hline stat_identity - used by a large number of geoms stat_qq stat_quantile - used by geom_quantile stat_smooth - used by geom_smooth stat_spoke stat_sum stat_summary stat_unique stat_vline - used by geom_vline 7.1.8 Color + [ColorBrewer scales](https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3) + Hexadecimal color code chart (#fig:Hexadecimal color code chart)Figure: Hexadecimal color code chart 7.1.9 Thema theme_grey() - the default theme, with a grey background theme_bw() - a theme with a white background ggplot2 includes eight themes by default, as shown in Figure. Many more are included in add-on packages like ggthemes, by Jeffrey Arnold. Figure 7.1: Figure: ggplot2 Thema 7.2 Scatter plot 7.2.1 Grouping Aesthetic Color Aesthetic Size Aesthetic Alpha Aesthetic Shape Aesthetic library(ggplot2) ## Color Aesthetic ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = class)) ## Set the aesthetic properties of your geom manually ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy), color = &quot;blue&quot;) ## Size Aesthetic ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, size = class)) ## Alpha aesthetic, which controls the transparency of the points ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, alpha = class)) ## shape aesthetic ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, shape = class)) 7.2.2 facet facet_wrap(), winding facet, only one standard can be applied to data classification, and the small shapes obtained from different sets of data are arranged in the order of winding from left to right and from top to bottom facet_grid(), facet the drawing of the combination of two variables ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_wrap(.~ class, nrow = 2) ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(.~ class) ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(drv ~ .) ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(drv ~ cyl) Replacing facet strips with text boxes using ggtext:: library(&quot;cowplot&quot;) ggplot(mpg, aes(cty, hwy)) + geom_point() + facet_wrap(~class) + theme_half_open(12) + background_grid() library(&quot;ggtext&quot;) ggplot(mpg, aes(cty, hwy)) + geom_point() + facet_wrap(~class) + theme_half_open(12) + background_grid() + theme( strip.background = element_blank(), strip.text = element_textbox( size = 12, color = &quot;white&quot;, fill = &quot;#5D729D&quot;, box.color = &quot;#4A618C&quot;, halign = 0.5, linetype = 1, r = unit(5, &quot;pt&quot;), width = unit(1, &quot;npc&quot;), padding = margin(2, 0, 1, 0), margin = margin(3, 3, 3, 3) ) ) 7.2.3 geom_smooth ## display different aesthetics in different layers ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point(mapping = aes(color = class)) + geom_smooth() ## no aesthetic just grouping ggplot(data = mpg) + geom_smooth(mapping = aes(x = displ, y = hwy, group = drv)) + geom_point(mapping = aes(x = displ, y = hwy, color = class)) ## linetype aesthetic set the shape of a point ggplot(data = mpg) + geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv)) ## color aesthetic ggplot(data = mpg) + geom_smooth( mapping = aes(x = displ, y = hwy, color = drv), show.legend = FALSE ) ## Linear line ggplot(mpg, aes(cty, hwy))+ geom_point() + geom_smooth(method=&quot;lm&quot;, se=F) + theme_bw()+ labs(subtitle=&quot;mpg: city vs highway mileage&quot;, y=&quot;hwy&quot;, x=&quot;cty&quot;, title=&quot;Scatterplot with overlapping points&quot;, caption=&quot;Source: midwest&quot;) ## 234 ## ctyhwy ## jitter_geom ggplot(mpg, aes(cty, hwy))+ geom_point() + theme_bw()+ geom_jitter(width = .5, size=1) + labs(subtitle=&quot;mpg: city vs highway mileage&quot;, y=&quot;hwy&quot;, x=&quot;cty&quot;, title=&quot;Jittered Points&quot;) 7.2.4 geom_errorbar PrimEnd &lt;- data.frame(&#39;Primary Endpoint&#39;=c(&quot;Primary Analysis&quot;, &quot;Sensitivity Analysis 1&quot;, &quot;Sensitivity Analysis 2&quot;, &quot;Primary Analysis after imputation&quot;), mean=c(-0.2945, -0.08334, -0.2926, -0.2395), LL=c(-0.9612, -0.2861, -0.9344, -0.7521), UL=c(0.3722, 0.1194, 0.3491, 0.2730), pvalue=c(&quot;P = 0.313&quot;, &quot;P = 0.347&quot;, &quot;P = 0.304&quot;,&quot;P = 0.359&quot;)) level &lt;- PrimEnd$Primary.Endpoint PrimEnd$Primary.Endpoint &lt;- factor(PrimEnd$Primary.Endpoint, levels=level) library(ggplot2) ggplot(PrimEnd, aes(x=Primary.Endpoint, y=mean)) + geom_line() + geom_point()+ geom_text(aes(label=pvalue),hjust=-0.2, vjust=0) + geom_hline(aes(yintercept=0, color=&quot;black&quot;, linetype=&quot;dot&quot;)) + geom_errorbar(aes(ymin=LL, ymax=UL), width = 0.5, size = 0.5)+ theme_bw() + theme(legend.position = &quot;none&quot;) + labs(x = &quot;&quot;, y = &quot;Difference between the IOLs&quot;, title = &quot;Superiority analysis in mean absolute rotation between Visit H0 (sitting) and H1&quot;) 7.2.5 Dot Plot Order fct_reorder: Modifying factor order library(forcats) library(dplyr) relig_summary &lt;- gss_cat %&gt;% group_by(relig) %&gt;% summarise( age = mean(age, na.rm = TRUE), tvhours = mean(tvhours, na.rm = TRUE), n = n() ) ggplot(relig_summary, aes(tvhours, relig)) + geom_point() ggplot(relig_summary, aes(tvhours, fct_reorder(relig, tvhours))) + geom_point() Diverging Dot Plot # Data Prep data(&quot;mtcars&quot;) # load data mtcars$`car name` &lt;- rownames(mtcars) # create new column for car names mtcars$mpg_z &lt;- round((mtcars$mpg - mean(mtcars$mpg))/sd(mtcars$mpg), 2) # compute normalized mpg mtcars$mpg_type &lt;- ifelse(mtcars$mpg_z &lt; 0, &quot;below&quot;, &quot;above&quot;) # above / below avg flag mtcars &lt;- mtcars[order(mtcars$mpg_z), ] # sort mtcars$`car name` &lt;- factor(mtcars$`car name`, levels = mtcars$`car name`) # convert to factor to retain sorted order in plot. ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) + geom_point(stat=&#39;identity&#39;, aes(col=mpg_type), size=6) + scale_color_manual(name=&quot;Mileage&quot;, labels = c(&quot;Above Average&quot;, &quot;Below Average&quot;), values = c(&quot;above&quot;=&quot;#00ba38&quot;, &quot;below&quot;=&quot;#f8766d&quot;)) + geom_text(color=&quot;white&quot;, size=2) + labs(title=&quot;Diverging Dot Plot&quot;, subtitle=&quot;Normalized mileage from &#39;mtcars&#39;: Dotplot&quot;) + ylim(-2.5, 2.5) + coord_flip() ### Diverging Lollipop Chart ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) + geom_point(stat=&#39;identity&#39;, fill=&quot;black&quot;, size=6) + geom_segment(aes(y = 0, x = `car name`, yend = mpg_z, xend = `car name`), color = &quot;black&quot;) + geom_text(color=&quot;white&quot;, size=2) + labs(title=&quot;Diverging Lollipop Chart&quot;, subtitle=&quot;Normalized mileage from &#39;mtcars&#39;: Lollipop&quot;) + ylim(-2.5, 2.5) + coord_flip() # Diverging Barcharts ggplot(mtcars, aes(x=`car name`, y=mpg_z, label=mpg_z)) + geom_bar(stat=&#39;identity&#39;, aes(fill=mpg_type), width=.5) + scale_fill_manual(name=&quot;Mileage&quot;, labels = c(&quot;Above Average&quot;, &quot;Below Average&quot;), values = c(&quot;above&quot;=&quot;#00ba38&quot;, &quot;below&quot;=&quot;#f8766d&quot;)) + labs(subtitle=&quot;Normalised mileage from &#39;mtcars&#39;&quot;, title= &quot;Diverging Bars&quot;) + coord_flip() + theme_bw() 7.2.6 Label and Title + ggtitle(\"Area Vs Population\", subtitle=\"From midwest dataset\") + xlab(\"Area\") + ylab(\"Population\") ggplot(midwest, aes(x=area, y=poptotal)) + geom_point() + geom_smooth(method=&quot;lm&quot;) + coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000)) + labs(title=&quot;Area Vs Population&quot;, subtitle=&quot;From midwest dataset&quot;, y=&quot;Population&quot;, x=&quot;Area&quot;, caption=&quot;Midwest Demographics&quot;) ## Or ggplot(midwest, aes(x=area, y=poptotal)) + geom_point() + geom_smooth(method=&quot;lm&quot;) + coord_cartesian(xlim=c(0,0.1), ylim=c(0, 1000000)) + ggtitle(&quot;Area Vs Population&quot;, subtitle=&quot;From midwest dataset&quot;) + xlab(&quot;Area&quot;) + ylab(&quot;Population&quot;) Change the Title rendering using ggtext::element_textbox() ggplot(mtcars, aes(disp, mpg)) + geom_point() + labs( title = &quot;&lt;b&gt;Fuel economy vs. engine displacement&lt;/b&gt;&lt;br&gt; &lt;span style = &#39;font-size:10pt&#39;&gt;Lorem ipsum *dolor sit amet,* consectetur adipiscing elit, **sed do eiusmod tempor incididunt** ut labore et dolore magna aliqua. &lt;span style = &#39;color:red;&#39;&gt;Ut enim ad minim veniam,&lt;/span&gt; quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.&lt;/span&gt;&quot;, x = &quot;displacement (in&lt;sup&gt;3&lt;/sup&gt;)&quot;, y = &quot;Miles per gallon (mpg)&lt;br&gt;&lt;span style = &#39;font-size:8pt&#39;&gt;A measure of the car&#39;s fuel efficiency.&lt;/span&gt;&quot; ) + theme( plot.title.position = &quot;plot&quot;, plot.title = element_textbox_simple( size = 13, lineheight = 1, padding = margin(5.5, 5.5, 5.5, 5.5), margin = margin(0, 0, 5.5, 0), fill = &quot;cornsilk&quot; ), axis.title.x = element_textbox_simple( width = NULL, padding = margin(4, 4, 4, 4), margin = margin(4, 0, 0, 0), linetype = 1, r = grid::unit(8, &quot;pt&quot;), fill = &quot;azure1&quot; ), axis.title.y = element_textbox_simple( hjust = 0, orientation = &quot;left-rotated&quot;, minwidth = unit(1, &quot;in&quot;), maxwidth = unit(2, &quot;in&quot;), padding = margin(4, 4, 2, 4), margin = margin(0, 0, 2, 0), fill = &quot;lightsteelblue1&quot; ) ) 7.2.7 Residuals modf2 &lt;- fortify(lm(formular, data = rf10_comp)) ggplot(modf2, aes(x = modf$bmi, y = .resid)) + geom_point()+ geom_hline(aes(yintercept=0), colour=&quot;#990000&quot;) + labs(title=&quot;Residuals plot for BMI using MICE RF with 10 trees&quot;, x = &quot;BMI&quot;, y = &quot;Residuals&quot;)+ theme_classic() ## Standardized Residuals modf &lt;- fortify(lm(formular, data = data)) ggplot(modf, aes(x = modf$bmi, y = .stdresid)) + geom_point()+ geom_hline(aes(yintercept=0), colour=&quot;#990000&quot;) + labs(title=&quot;Standardised residuals plot for BMI using Full data&quot;, x = &quot;BMI&quot;, y = &quot;Residuals&quot;)+ theme_classic() 7.2.8 Encircling In geom_encircle(), set the data to a new data frame containing only points (rows) or points of interest. In addition, you can expand the curve so that it passes outside the point. The color and size (thickness) of the curve can also be modified. # install &#39;ggalt&#39; pkg # devtools::install_github(&quot;hrbrmstr/ggalt&quot;) options(scipen = 999) library(ggalt) midwest_select &lt;- midwest[midwest$poptotal &gt; 350000 &amp; midwest$poptotal &lt;= 500000 &amp; midwest$area &gt; 0.01 &amp; midwest$area &lt; 0.1, ] # Plot ggplot(midwest, aes(x=area, y=poptotal)) + geom_point(aes(col=state, size=popdensity)) + # draw points geom_smooth(method=&quot;loess&quot;, se=F) + xlim(c(0, 0.1)) + ylim(c(0, 500000)) + # draw smoothing line geom_encircle(aes(x=area, y=poptotal), data=midwest_select, color=&quot;red&quot;, size=2, expand=0.08) + # encircle labs(subtitle=&quot;Area Vs Population&quot;, y=&quot;Population&quot;, x=&quot;Area&quot;, title=&quot;Scatterplot + Encircle&quot;, caption=&quot;Source: midwest&quot;) 7.2.9 Dumbbell Plot   Y library(ggalt) health &lt;- read.csv(&quot;https://raw.githubusercontent.com/selva86/datasets/master/health.csv&quot;) health$Area &lt;- factor(health$Area, levels=as.character(health$Area)) # for right ordering of the dumbells # health$Area &lt;- factor(health$Area) ggplot(health, aes(x=pct_2013, xend=pct_2014, y=Area, group=Area)) + geom_dumbbell(color=&quot;#a3c4dc&quot;, size=0.75, point.colour.l=&quot;#0e668b&quot;) + labs(x=NULL, y=NULL, title=&quot;Dumbbell Chart&quot;, subtitle=&quot;Pct Change: 2013 vs 2014&quot;, caption=&quot;Source: https://github.com/hrbrmstr/ggalt&quot;) + theme_classic()+ theme(plot.title = element_text(hjust=0.5, face=&quot;bold&quot;), plot.background=element_rect(fill=&quot;#f7f7f7&quot;), panel.background=element_rect(fill=&quot;#f7f7f7&quot;), panel.grid.minor=element_blank(), panel.grid.major.y=element_blank(), panel.grid.major.x=element_line(), axis.ticks=element_blank(), legend.position=&quot;top&quot;, panel.border=element_blank()) 7.3 Histogram library(&quot;tidyverse&quot;) smaller &lt;- diamonds %&gt;% filter(carat &lt; 3) ggplot(data = smaller, mapping = aes(x = carat, fill=color))+ geom_histogram(binwidth = 0.1, col=&quot;black&quot;, size=.1) + labs(title=&quot;Histogram with Auto Binning&quot;, subtitle=&quot;Engine Displacement across Vehicle Classes&quot;) ## geom_histogram(bins=5, col=&quot;black&quot;, size=.1) ## Change the color according the number of legend ## scale_color_manual(values = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;)) ## scale_fill_manual(values = c(&quot;#00AFBB&quot;, &quot;#E7B800&quot;)) 7.3.1 geom_freqpoly() library(&quot;tidyverse&quot;) smaller &lt;- diamonds %&gt;% filter(carat &lt; 3) ggplot(data = smaller, mapping = aes(x = carat, colour = cut)) + geom_freqpoly(binwidth = 0.1) ## display density instead of count ggplot(data = diamonds, mapping = aes(x = price, y = ..density..)) + geom_freqpoly(mapping = aes(colour = cut), binwidth = 500) ## geom_density ggplot(mpg, aes(cty)) + geom_density(aes(fill=factor(cyl)), alpha=0.5) + labs(title=&quot;Density plot&quot;, subtitle=&quot;City Mileage Grouped by Number of cylinders&quot;, caption=&quot;Source: mpg&quot;, x=&quot;City Mileage&quot;, fill=&quot;# Cylinders&quot;) 7.3.2 Marginal Histogram / Boxplot This can be achieved using the ggMarginal() function in the ggExtra package. In addition to histograms, you can choose to draw marginal box plots or density plots by setting the corresponding type options. library(&quot;ggExtra&quot;) mpg_select &lt;- mpg[mpg$hwy &gt;= 35 &amp; mpg$cty &gt; 27, ] g &lt;- ggplot(mpg, aes(cty, hwy)) + geom_count() + geom_smooth(method=&quot;lm&quot;, se=F) + theme_bw() ggMarginal(g, type = &quot;histogram&quot;, fill=&quot;transparent&quot;) ggMarginal(g, type = &quot;boxplot&quot;, fill=&quot;transparent&quot;) ggMarginal(g, type = &quot;density&quot;, fill=&quot;transparent&quot;) 7.4 Bar plot 7.4.1 Aesthetic ## Color Aesthetic ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = cut )) ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = color )) ## Position aesthetic ## position adjustment options: &quot;identity&quot;, &quot;dodge&quot; or &quot;fill&quot;. ## position = fill  ## position = dodge  ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + geom_bar(alpha = 1/5, position = &quot;identity&quot;) ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + geom_bar(fill = NA, position = &quot;identity&quot;)+ facet_wrap(~color) + theme(legend.position = &quot;top&quot;) ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = clarity), position = &quot;fill&quot;, width = 0.5) + theme(axis.text.x = element_text(angle=65, vjust=0.6)) + labs(title=&quot;Histogram on Categorical Variable&quot;, subtitle=&quot;Manufacturer across Vehicle Classes&quot;) ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = clarity), position = &quot;dodge&quot;) Change outline colors It is also possible to change manually barplot line colors using the functions : scale_color_manual() : to use custom color palettes p+scale_color_manual(values=c(\"#999999\", \"#E69F00\", \"#56B4E9\")) scale_color_brewer() : to use color palettes from RColorBrewer package p+scale_color_brewer(palette=\"Dark2\") scale_color_grey() : to use grey color palettes p + scale_color_grey() + theme_classic() Change fill colors scale_fill_manual() : to use custom colors p+scale_fill_manual(values=c(\"#999999\", \"#E69F00\", \"#56B4E9\")) scale_fill_brewer() : to use color palettes from RColorBrewer package p+scale_fill_brewer(palette=\"Dark2\") scale_fill_grey() : to use grey color palettes p + scale_fill_grey() Change the legend position Change bar fill colors to blues p &lt;- p+scale_fill_brewer(palette=\"Blues\") Change the legend position p + theme(legend.position=\"top\") p + theme(legend.position=\"bottom\") Remove legend p + theme(legend.position=\"none\") Change the order of items in the legend p + scale_x_discrete(limits=c(\"D2\", \"D0.5\", \"D1\")) 7.4.2 Proportion ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, fill = color )) ## proportion, rather than count: ggplot(data = diamonds) + geom_bar(mapping = aes(x = cut, y = ..prop.., group = 1))+ scale_y_continuous(labels = scales::percent) + labs(title=&quot;Name&quot;)+ theme_classic() ### coord ## coord_polar() uses polar coordinates bar &lt;- ggplot(data = diamonds) + geom_bar( mapping = aes(x = cut, fill = cut), show.legend = FALSE, width = 1 ) + theme(aspect.ratio = 1) + labs(x = NULL, y = NULL) bar + coord_flip() bar + coord_polar() 7.4.3 stat=identity Rotation_5 &lt;- readRDS(file = &quot;./01_Datasets/Rotation_5.rds&quot;) ggplot(data = Rotation_5, aes(x = Visit, y= Percentage, fill=Treatment)) + geom_bar(stat=&quot;identity&quot;, width =0.5, position=position_dodge()) + geom_text(aes(label=N), vjust=1.6, color=&quot;white&quot;, position = position_dodge(0.5), size=3.5)+ geom_text(aes(label=P, x=Visit, y=0.97),hjust=0.4, size=3.5)+ scale_fill_brewer(palette=&quot;Paired&quot;)+ scale_y_continuous(labels = scales::percent, breaks=seq(0, 1, 0.1)) + theme_bw() + theme(legend.position = &quot;none&quot;) + labs(x = &quot;&quot;, y = &quot;Responder rate&quot;, title = &quot;Rotational stability within 5° from Visit H0 (sitting)&quot;) 7.4.4 Ranking ### Ordered Bar Chart cty_mpg &lt;- aggregate(mpg$cty, by=list(mpg$manufacturer), FUN=mean) # aggregate colnames(cty_mpg) &lt;- c(&quot;make&quot;, &quot;mileage&quot;) # change column names cty_mpg &lt;- cty_mpg[order(cty_mpg$mileage), ] # sort cty_mpg$make &lt;- factor(cty_mpg$make, levels = cty_mpg$make) # to retain the order in plot. # Draw plot ggplot(cty_mpg, aes(x=make, y=mileage)) + geom_bar(stat=&quot;identity&quot;, width=.5, fill=&quot;tomato3&quot;) + labs(title=&quot;Ordered Bar Chart&quot;, subtitle=&quot;Make Vs Avg. Mileage&quot;, caption=&quot;source: mpg&quot;) + theme(axis.text.x = element_text(angle=65, vjust=0.6)) + theme_bw() ### Lollipop Chart ### Lollipop charts conveys the same information as in bar charts. By reducing the thick bars into thin lines, it reduces the clutter and lays more emphasis on the value. It looks nice and modern. ggplot(cty_mpg, aes(x=make, y=mileage)) + geom_point(size=3) + geom_segment(aes(x=make, xend=make, y=0, yend=mileage)) + labs(title=&quot;Lollipop Chart&quot;, subtitle=&quot;Make Vs Avg. Mileage&quot;, caption=&quot;source: mpg&quot;) + theme(axis.text.x = element_text(angle=65, vjust=0.6)) 7.5 Box Plot 7.5.1 stat=identity Cylinder3 &lt;- readRDS(file = &quot;./01_Datasets/Cylinder_Baseline.rds&quot;) library(ggplot2) ggplot(Cylinder3,aes(x=Subgroup,fill=Treatment))+ geom_boxplot(aes(lower=` Mean`-` SD`, upper=` Mean`+` SD`, middle=` Mean`, ymin=` Min`, ymax=` Max`), stat=&quot;identity&quot;)+ geom_text(aes(label=`P-Value`, x=Subgroup, y=5.5),hjust=0.4)+ coord_flip() + theme_bw() + theme(legend.position = &quot;bottom&quot;) + labs(x = &quot;Subgroups&quot;, y = &quot;Cylinder [D]&quot;, title = &quot;Subjective refraction Cylinder at Baseline&quot;) MeanRotation &lt;- readRDS(file = &quot;./01_Datasets/MeanRotation.rds&quot; ) ggplot(MeanRotation, aes(x=Visit,fill=Treatment))+ geom_boxplot(aes(lower=mean-SD, upper=mean+SD, middle=mean, ymin=min, ymax=max), stat=&quot;identity&quot;)+ geom_text(aes(label=n, x=Visit, y=mean+1.5), vjust=1.3, color=&quot;white&quot;, position = position_dodge(0.8), size=3.5)+ geom_text(aes(label=P,colour=label_color, x=Visit, y=25),hjust=0.4, size=3.5,show.legend = FALSE)+ scale_fill_brewer(palette=&quot;Paired&quot;)+ facet_wrap(.~ Subgroup, nrow = 2)+ coord_flip() + theme_bw() + theme(legend.position = &quot;bottom&quot;) + labs(x = &quot;&quot;, y = &quot;Mean absolute rotation&quot;, title = &quot;Mean absolute rotation by visit&quot;) 7.6 Text rendering 7.6.1 ggtext Markdown in theme elements The ggtext package defines two new theme elements, element_markdown() and element_textbox(). Both behave similarly to element_text() but render the provided text as markdown/html. element_markdown() is meant as a direct replacement for element_text(), and it renders text without word wrapping. To start a new line, use the tag or add two spaces before the end of a line. ## remotes::install_github(&quot;wilkelab/ggtext&quot;) ## install.packages(&quot;ggtext&quot;) library(&quot;ggtext&quot;) library(&quot;tidyverse&quot;) library(&quot;glue&quot;) data &lt;- tibble( bactname = c(&quot;Staphylococcaceae&quot;, &quot;Moraxella&quot;, &quot;Streptococcus&quot;, &quot;Acinetobacter&quot;), OTUname = c(&quot;OTU 1&quot;, &quot;OTU 2&quot;, &quot;OTU 3&quot;, &quot;OTU 4&quot;), value = c(-0.5, 0.5, 2, 3) ) data %&gt;% mutate( color = c(&quot;#009E73&quot;, &quot;#D55E00&quot;, &quot;#0072B2&quot;, &quot;#000000&quot;), name = glue(&quot;&lt;i style=&#39;color:{color}&#39;&gt;{bactname}&lt;/i&gt; ({OTUname})&quot;), name = fct_reorder(name, value) ) %&gt;% ggplot(aes(value, name, fill = color)) + geom_col(alpha = 0.5) + scale_fill_identity() + labs(caption = &quot;Example posted on **stackoverflow.com**&lt;br&gt;(using made-up data)&quot;) + theme( axis.text.y = element_markdown(), plot.caption = element_markdown(lineheight = 1.2) ) 7.6.2 ggrepel There are two important functions in ggrepel R packages: geom_label_repel() geom_text_repel() library(&quot;ggrepel&quot;) ## Take a subset of 15 random points set.seed(1234) ss &lt;- sample(1:32, 15) df &lt;- mtcars[ss, ] ## Create a scatter plot: p &lt;- ggplot(df, aes(wt, mpg)) + geom_point(color = &#39;red&#39;) + theme_classic(base_size = 10) ## Add text labels: ## Add text annotations using ggplot2::geom_text p + geom_text(aes(label = rownames(df)), size = 3.5) ## Use ggrepel::geom_text_repel require(&quot;ggrepel&quot;) set.seed(42) p + geom_text_repel(aes(label = rownames(df)), size = 3.5) ## Change color by groups p + geom_label_repel(aes(label = rownames(df), fill = factor(cyl)), color = &#39;white&#39;, size = 3.5) + theme(legend.position = &quot;bottom&quot;) "]]
