<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 18 Correlation and Regression | As a Statistician</title>
  <meta name="description" content="This book involves different statistical principles and methods, including the application of SAS and R, and aims to accumulate personal statistical knowledge." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 18 Correlation and Regression | As a Statistician" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book involves different statistical principles and methods, including the application of SAS and R, and aims to accumulate personal statistical knowledge." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 18 Correlation and Regression | As a Statistician" />
  
  <meta name="twitter:description" content="This book involves different statistical principles and methods, including the application of SAS and R, and aims to accumulate personal statistical knowledge." />
  

<meta name="author" content="Zehui Bai" />


<meta name="date" content="2021-05-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="non-parametric-test.html"/>
<link rel="next" href="advanced-linear-regression.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="input-and-format.html"><a href="input-and-format.html"><i class="fa fa-check"></i><b>2</b> Input and Format</a><ul>
<li class="chapter" data-level="2.1" data-path="input-and-format.html"><a href="input-and-format.html#import-in-sas"><i class="fa fa-check"></i><b>2.1</b> Import in SAS</a></li>
<li class="chapter" data-level="2.2" data-path="input-and-format.html"><a href="input-and-format.html#import-in-r"><i class="fa fa-check"></i><b>2.2</b> Import in R</a></li>
<li class="chapter" data-level="2.3" data-path="input-and-format.html"><a href="input-and-format.html#package-readr"><i class="fa fa-check"></i><b>2.3</b> Package readr</a></li>
<li class="chapter" data-level="2.4" data-path="input-and-format.html"><a href="input-and-format.html#package-strings"><i class="fa fa-check"></i><b>2.4</b> Package Strings</a></li>
<li class="chapter" data-level="2.5" data-path="input-and-format.html"><a href="input-and-format.html#package-forcats"><i class="fa fa-check"></i><b>2.5</b> Package forcats</a></li>
<li class="chapter" data-level="2.6" data-path="input-and-format.html"><a href="input-and-format.html#package-lubridate"><i class="fa fa-check"></i><b>2.6</b> Package lubridate</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-management-in-sas.html"><a href="data-management-in-sas.html"><i class="fa fa-check"></i><b>3</b> Data Management in SAS</a></li>
<li class="chapter" data-level="4" data-path="data-management-in-r.html"><a href="data-management-in-r.html"><i class="fa fa-check"></i><b>4</b> Data Management in R</a></li>
<li class="chapter" data-level="5" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>5</b> SQL</a></li>
<li class="chapter" data-level="6" data-path="space.html"><a href="space.html"><i class="fa fa-check"></i><b>6</b> ^_^ Space</a></li>
<li class="chapter" data-level="7" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>7</b> ggplot2</a></li>
<li class="chapter" data-level="8" data-path="proc-sqplot.html"><a href="proc-sqplot.html"><i class="fa fa-check"></i><b>8</b> Proc Sqplot</a><ul>
<li class="chapter" data-level="8.1" data-path="proc-sqplot.html"><a href="proc-sqplot.html#scatter-plot"><i class="fa fa-check"></i><b>8.1</b> Scatter Plot</a><ul>
<li class="chapter" data-level="8.1.1" data-path="proc-sqplot.html"><a href="proc-sqplot.html#vector-in-scatter-plot"><i class="fa fa-check"></i><b>8.1.1</b> Vector in scatter Plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="space.html"><a href="space.html#space"><i class="fa fa-check"></i><b>9</b> ^_^ Space</a></li>
<li class="chapter" data-level="10" data-path="space.html"><a href="space.html#space"><i class="fa fa-check"></i><b>10</b> ^_^ Space</a></li>
<li class="chapter" data-level="11" data-path="descriptive-statistics-in-sas.html"><a href="descriptive-statistics-in-sas.html"><i class="fa fa-check"></i><b>11</b> Descriptive Statistics in SAS</a><ul>
<li class="chapter" data-level="11.1" data-path="descriptive-statistics-in-sas.html"><a href="descriptive-statistics-in-sas.html#proc-freq"><i class="fa fa-check"></i><b>11.1</b> Proc Freq</a></li>
<li class="chapter" data-level="11.2" data-path="descriptive-statistics-in-sas.html"><a href="descriptive-statistics-in-sas.html#proc-means"><i class="fa fa-check"></i><b>11.2</b> Proc Means</a></li>
<li class="chapter" data-level="11.3" data-path="descriptive-statistics-in-sas.html"><a href="descriptive-statistics-in-sas.html#proc-tabulatte"><i class="fa fa-check"></i><b>11.3</b> Proc Tabulatte</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html"><i class="fa fa-check"></i><b>12</b> Descriptive Statistics in R</a><ul>
<li class="chapter" data-level="12.1" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#package-pape"><i class="fa fa-check"></i><b>12.1</b> Package pape</a></li>
<li class="chapter" data-level="12.2" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#package-summarytools"><i class="fa fa-check"></i><b>12.2</b> Package summarytools</a></li>
<li class="chapter" data-level="12.3" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#package-comparegroups"><i class="fa fa-check"></i><b>12.3</b> Package compareGroups</a></li>
<li class="chapter" data-level="12.4" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#package-kableextra"><i class="fa fa-check"></i><b>12.4</b> Package kableExtra</a><ul>
<li class="chapter" data-level="12.4.1" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#kable_styling"><i class="fa fa-check"></i><b>12.4.1</b> kable_styling</a></li>
<li class="chapter" data-level="12.4.2" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#columnrow-specification"><i class="fa fa-check"></i><b>12.4.2</b> Column/Row Specification</a></li>
<li class="chapter" data-level="12.4.3" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#grouping-columnsrows"><i class="fa fa-check"></i><b>12.4.3</b> Grouping columns/rows</a></li>
<li class="chapter" data-level="12.4.4" data-path="descriptive-statistics-in-r.html"><a href="descriptive-statistics-in-r.html#add-footnote"><i class="fa fa-check"></i><b>12.4.4</b> Add Footnote</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>13</b> Distributions</a><ul>
<li class="chapter" data-level="13.1" data-path="distributions.html"><a href="distributions.html#quantile-function-in-sas"><i class="fa fa-check"></i><b>13.1</b> Quantile Function in SAS</a></li>
<li class="chapter" data-level="13.2" data-path="distributions.html"><a href="distributions.html#binomial-distribution"><i class="fa fa-check"></i><b>13.2</b> Binomial distribution</a></li>
<li class="chapter" data-level="13.3" data-path="distributions.html"><a href="distributions.html#negative-binomial-distribution"><i class="fa fa-check"></i><b>13.3</b> Negative binomial distribution</a></li>
<li class="chapter" data-level="13.4" data-path="distributions.html"><a href="distributions.html#multinomial-distribution"><i class="fa fa-check"></i><b>13.4</b> Multinomial distribution</a></li>
<li class="chapter" data-level="13.5" data-path="distributions.html"><a href="distributions.html#normal-distribution"><i class="fa fa-check"></i><b>13.5</b> Normal Distribution</a></li>
<li class="chapter" data-level="13.6" data-path="distributions.html"><a href="distributions.html#multivariate-normal-distribution"><i class="fa fa-check"></i><b>13.6</b> Multivariate normal distribution</a></li>
<li class="chapter" data-level="13.7" data-path="distributions.html"><a href="distributions.html#poisson-distribution"><i class="fa fa-check"></i><b>13.7</b> Poisson distribution</a></li>
<li class="chapter" data-level="13.8" data-path="distributions.html"><a href="distributions.html#exponential-distribution"><i class="fa fa-check"></i><b>13.8</b> Exponential distribution</a></li>
<li class="chapter" data-level="13.9" data-path="distributions.html"><a href="distributions.html#gamma-distribution"><i class="fa fa-check"></i><b>13.9</b> Gamma distribution</a></li>
<li class="chapter" data-level="13.10" data-path="distributions.html"><a href="distributions.html#weibull-distribution"><i class="fa fa-check"></i><b>13.10</b> Weibull Distribution</a></li>
<li class="chapter" data-level="13.11" data-path="distributions.html"><a href="distributions.html#beta-distribution"><i class="fa fa-check"></i><b>13.11</b> Beta Distribution</a><ul>
<li class="chapter" data-level="13.11.1" data-path="distributions.html"><a href="distributions.html#beta分布及其函数公式推导"><i class="fa fa-check"></i><b>13.11.1</b> Beta分布及其函数公式推导</a></li>
<li class="chapter" data-level="13.11.2" data-path="distributions.html"><a href="distributions.html#beta-函数和-gamma-函数"><i class="fa fa-check"></i><b>13.11.2</b> Beta 函数和 Gamma 函数</a></li>
<li class="chapter" data-level="13.11.3" data-path="distributions.html"><a href="distributions.html#beta-分布的期望与方差"><i class="fa fa-check"></i><b>13.11.3</b> Beta 分布的期望与方差</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="parametric-test.html"><a href="parametric-test.html"><i class="fa fa-check"></i><b>14</b> Parametric Test</a><ul>
<li class="chapter" data-level="14.1" data-path="descriptive-statistics-in-sas.html"><a href="descriptive-statistics-in-sas.html#proc-freq"><i class="fa fa-check"></i><b>14.1</b> Proc FREQ</a><ul>
<li class="chapter" data-level="14.1.1" data-path="parametric-test.html"><a href="parametric-test.html#ods-table-names"><i class="fa fa-check"></i><b>14.1.1</b> ODS Table Names</a></li>
<li class="chapter" data-level="14.1.2" data-path="parametric-test.html"><a href="parametric-test.html#ods-plots"><i class="fa fa-check"></i><b>14.1.2</b> ODS Plots</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="parametric-test.html"><a href="parametric-test.html#section"><i class="fa fa-check"></i><b>14.2</b> </a></li>
<li class="chapter" data-level="14.3" data-path="parametric-test.html"><a href="parametric-test.html#binomial-test"><i class="fa fa-check"></i><b>14.3</b> Binomial test</a><ul>
<li class="chapter" data-level="14.3.1" data-path="parametric-test.html"><a href="parametric-test.html#mathematical-formula"><i class="fa fa-check"></i><b>14.3.1</b> Mathematical Formula</a></li>
<li class="chapter" data-level="14.3.2" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation"><i class="fa fa-check"></i><b>14.3.2</b> R implementation</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="parametric-test.html"><a href="parametric-test.html#fishers-exact-test"><i class="fa fa-check"></i><b>14.4</b> Fisher’s Exact Test</a><ul>
<li class="chapter" data-level="14.4.1" data-path="parametric-test.html"><a href="parametric-test.html#mathematical-formula-1"><i class="fa fa-check"></i><b>14.4.1</b> Mathematical Formula</a></li>
<li class="chapter" data-level="14.4.2" data-path="parametric-test.html"><a href="parametric-test.html#sas-implementation"><i class="fa fa-check"></i><b>14.4.2</b> SAS implementation</a></li>
<li class="chapter" data-level="14.4.3" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation-1"><i class="fa fa-check"></i><b>14.4.3</b> R implementation</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="parametric-test.html"><a href="parametric-test.html#contingency-test"><i class="fa fa-check"></i><b>14.5</b> Contingency test</a></li>
<li class="chapter" data-level="14.6" data-path="parametric-test.html"><a href="parametric-test.html#mcnemars-test"><i class="fa fa-check"></i><b>14.6</b> McNemar’s test</a></li>
<li class="chapter" data-level="14.7" data-path="parametric-test.html"><a href="parametric-test.html#cochranmantelhaenszel-test"><i class="fa fa-check"></i><b>14.7</b> Cochran–Mantel–Haenszel Test</a><ul>
<li class="chapter" data-level="14.7.1" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation-2"><i class="fa fa-check"></i><b>14.7.1</b> R implementation</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="parametric-test.html"><a href="parametric-test.html#correlation-test"><i class="fa fa-check"></i><b>14.8</b> Correlation Test</a><ul>
<li class="chapter" data-level="14.8.1" data-path="parametric-test.html"><a href="parametric-test.html#pearson-correlation"><i class="fa fa-check"></i><b>14.8.1</b> Pearson correlation</a></li>
<li class="chapter" data-level="14.8.2" data-path="parametric-test.html"><a href="parametric-test.html#spearman-correlation"><i class="fa fa-check"></i><b>14.8.2</b> Spearman correlation</a></li>
<li class="chapter" data-level="14.8.3" data-path="parametric-test.html"><a href="parametric-test.html#kendall-correlation"><i class="fa fa-check"></i><b>14.8.3</b> Kendall correlation</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="parametric-test.html"><a href="parametric-test.html#two-sample-t-test"><i class="fa fa-check"></i><b>14.9</b> Two Sample T-Test</a><ul>
<li class="chapter" data-level="14.9.1" data-path="parametric-test.html"><a href="parametric-test.html#sas-implementation-1"><i class="fa fa-check"></i><b>14.9.1</b> SAS implementation</a></li>
<li class="chapter" data-level="14.9.2" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation-3"><i class="fa fa-check"></i><b>14.9.2</b> R implementation</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="parametric-test.html"><a href="parametric-test.html#normality-test"><i class="fa fa-check"></i><b>14.10</b> Normality test</a><ul>
<li class="chapter" data-level="14.10.1" data-path="parametric-test.html"><a href="parametric-test.html#sas-implementation-2"><i class="fa fa-check"></i><b>14.10.1</b> SAS implementation</a></li>
<li class="chapter" data-level="14.10.2" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation-4"><i class="fa fa-check"></i><b>14.10.2</b> R implementation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="multiple-comparison.html"><a href="multiple-comparison.html"><i class="fa fa-check"></i><b>15</b> Multiple Comparison</a><ul>
<li class="chapter" data-level="15.1" data-path="multiple-comparison.html"><a href="multiple-comparison.html#one-way-anova"><i class="fa fa-check"></i><b>15.1</b> One-Way ANOVA</a><ul>
<li class="chapter" data-level="15.1.1" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation"><i class="fa fa-check"></i><b>15.1.1</b> R implementation</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="multiple-comparison.html"><a href="multiple-comparison.html#anova-model-diagnosis"><i class="fa fa-check"></i><b>15.2</b> ANOVA Model Diagnosis</a><ul>
<li class="chapter" data-level="15.2.1" data-path="multiple-comparison.html"><a href="multiple-comparison.html#homogeneity-test"><i class="fa fa-check"></i><b>15.2.1</b> Homogeneity Test</a></li>
<li class="chapter" data-level="15.2.2" data-path="multiple-comparison.html"><a href="multiple-comparison.html#normality-assumption"><i class="fa fa-check"></i><b>15.2.2</b> Normality assumption</a></li>
<li class="chapter" data-level="15.2.3" data-path="multiple-comparison.html"><a href="multiple-comparison.html#violation-of-assumptions"><i class="fa fa-check"></i><b>15.2.3</b> Violation of assumptions</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="multiple-comparison.html"><a href="multiple-comparison.html#two-ways-anova-test"><i class="fa fa-check"></i><b>15.3</b> Two-Ways ANOVA Test</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html"><i class="fa fa-check"></i><b>16</b> CI and Sample Size Calculation</a><ul>
<li class="chapter" data-level="16.1" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#point-estimates"><i class="fa fa-check"></i><b>16.1</b> Point Estimates</a></li>
<li class="chapter" data-level="16.2" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#binomial-ci"><i class="fa fa-check"></i><b>16.2</b> Binomial CI</a><ul>
<li class="chapter" data-level="16.2.1" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#binomial-ci-for-small-samples"><i class="fa fa-check"></i><b>16.2.1</b> Binomial CI for Small Samples</a></li>
<li class="chapter" data-level="16.2.2" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#package-binom"><i class="fa fa-check"></i><b>16.2.2</b> Package binom</a></li>
<li class="chapter" data-level="16.2.3" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#ci_single_proportion"><i class="fa fa-check"></i><b>16.2.3</b> %CI_Single_Proportion</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#incidence-rate-ci"><i class="fa fa-check"></i><b>16.3</b> Incidence rate CI</a></li>
<li class="chapter" data-level="16.4" data-path="ci-and-sample-size-calculation.html"><a href="ci-and-sample-size-calculation.html#package-pwr"><i class="fa fa-check"></i><b>16.4</b> Package: pwr</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="multiple-comparison.html"><a href="multiple-comparison.html#non-parametric-test"><i class="fa fa-check"></i><b>17</b> Non-Parametric Test</a></li>
<li class="chapter" data-level="18" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html"><i class="fa fa-check"></i><b>18</b> Correlation and Regression</a><ul>
<li class="chapter" data-level="18.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#correlation"><i class="fa fa-check"></i><b>18.1</b> Correlation</a><ul>
<li class="chapter" data-level="18.1.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#pearson-correlation-coefficient"><i class="fa fa-check"></i><b>18.1.1</b> Pearson correlation coefficient</a></li>
<li class="chapter" data-level="18.1.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#spearmans-rank-correlation-coefficient"><i class="fa fa-check"></i><b>18.1.2</b> Spearman’s rank correlation coefficient</a></li>
<li class="chapter" data-level="18.1.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#kendall-rank-correlation-coefficient"><i class="fa fa-check"></i><b>18.1.3</b> Kendall rank correlation coefficient</a></li>
<li class="chapter" data-level="18.1.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#intraclass-correlation"><i class="fa fa-check"></i><b>18.1.4</b> Intraclass correlation</a></li>
<li class="chapter" data-level="18.1.5" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#visualize-the-correlation-in-r"><i class="fa fa-check"></i><b>18.1.5</b> Visualize the correlation in R</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#ordinary-least-squares-ols"><i class="fa fa-check"></i><b>18.2</b> Ordinary least squares (OLS)</a><ul>
<li class="chapter" data-level="18.2.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#assumpions"><i class="fa fa-check"></i><b>18.2.1</b> Assumpions</a></li>
<li class="chapter" data-level="18.2.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#interpretation"><i class="fa fa-check"></i><b>18.2.2</b> Interpretation</a></li>
<li class="chapter" data-level="18.2.3" data-path="parametric-test.html"><a href="parametric-test.html#section"><i class="fa fa-check"></i><b>18.2.3</b> </a></li>
<li class="chapter" data-level="18.2.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#gauss-markov-theorem"><i class="fa fa-check"></i><b>18.2.4</b> Gauss-Markov Theorem</a></li>
<li class="chapter" data-level="18.2.5" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#limitation"><i class="fa fa-check"></i><b>18.2.5</b> limitation</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#model-statistics"><i class="fa fa-check"></i><b>18.3</b> Model Statistics</a><ul>
<li class="chapter" data-level="18.3.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#residuals-standard-error"><i class="fa fa-check"></i><b>18.3.1</b> Residuals Standard Error</a></li>
<li class="chapter" data-level="18.3.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#r-squared-and-adjusted-r-squared"><i class="fa fa-check"></i><b>18.3.2</b> R-Squared and Adjusted R-Squared</a></li>
<li class="chapter" data-level="18.3.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#t-statistic"><i class="fa fa-check"></i><b>18.3.3</b> T Statistic</a></li>
<li class="chapter" data-level="18.3.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#f-statistic"><i class="fa fa-check"></i><b>18.3.4</b> F Statistic</a></li>
<li class="chapter" data-level="18.3.5" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#confidence-intervals"><i class="fa fa-check"></i><b>18.3.5</b> Confidence Intervals</a></li>
<li class="chapter" data-level="18.3.6" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#likelihood-ratio-test"><i class="fa fa-check"></i><b>18.3.6</b> Likelihood-ratio test</a></li>
<li class="chapter" data-level="18.3.7" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#accuracy"><i class="fa fa-check"></i><b>18.3.7</b> Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#model-diagnostics"><i class="fa fa-check"></i><b>18.4</b> Model Diagnostics</a><ul>
<li class="chapter" data-level="18.4.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#checking-error-assumptions"><i class="fa fa-check"></i><b>18.4.1</b> Checking Error Assumptions</a></li>
<li class="chapter" data-level="18.4.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#finding-unusual-observations"><i class="fa fa-check"></i><b>18.4.2</b> Finding Unusual Observations</a></li>
<li class="chapter" data-level="18.4.3" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#checking-the-structure-of-the-model"><i class="fa fa-check"></i><b>18.4.3</b> Checking the Structure of the Model</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#sas-implementation-proc-reg"><i class="fa fa-check"></i><b>18.5</b> SAS implementation Proc Reg</a><ul>
<li class="chapter" data-level="18.5.1" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#options"><i class="fa fa-check"></i><b>18.5.1</b> Options</a></li>
<li class="chapter" data-level="18.5.2" data-path="correlation-and-regression.html"><a href="correlation-and-regression.html#diagnose"><i class="fa fa-check"></i><b>18.5.2</b> Diagnose</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="parametric-test.html"><a href="parametric-test.html#r-implementation"><i class="fa fa-check"></i><b>18.6</b> R implementation</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="advanced-linear-regression.html"><a href="advanced-linear-regression.html"><i class="fa fa-check"></i><b>19</b> Advanced Linear Regression</a></li>
<li class="chapter" data-level="20" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>20</b> Logistic Regression</a></li>
<li class="chapter" data-level="21" data-path="advanced-logistic-regression.html"><a href="advanced-logistic-regression.html"><i class="fa fa-check"></i><b>21</b> Advanced Logistic Regression</a></li>
<li class="chapter" data-level="22" data-path="survival-analysis.html"><a href="survival-analysis.html"><i class="fa fa-check"></i><b>22</b> Survival Analysis</a></li>
<li class="chapter" data-level="23" data-path="advanced-survival-analysis.html"><a href="advanced-survival-analysis.html"><i class="fa fa-check"></i><b>23</b> Advanced Survival Analysis</a></li>
<li class="chapter" data-level="24" data-path="count-data-regression.html"><a href="count-data-regression.html"><i class="fa fa-check"></i><b>24</b> Count Data Regression</a></li>
<li class="chapter" data-level="25" data-path="proportion-response-regression.html"><a href="proportion-response-regression.html"><i class="fa fa-check"></i><b>25</b> Proportion Response Regression</a></li>
<li class="chapter" data-level="26" data-path="mixed-model.html"><a href="mixed-model.html"><i class="fa fa-check"></i><b>26</b> Mixed Model</a></li>
<li class="chapter" data-level="27" data-path="generalized-linear-mixed-model.html"><a href="generalized-linear-mixed-model.html"><i class="fa fa-check"></i><b>27</b> Generalized Linear (Mixed) Model</a></li>
<li class="chapter" data-level="28" data-path="generalized-estimating-equation.html"><a href="generalized-estimating-equation.html"><i class="fa fa-check"></i><b>28</b> Generalized Estimating Equation</a></li>
<li class="chapter" data-level="29" data-path="time-series-analysis.html"><a href="time-series-analysis.html"><i class="fa fa-check"></i><b>29</b> Time Series Analysis</a></li>
<li class="chapter" data-level="30" data-path="meta-analysis.html"><a href="meta-analysis.html"><i class="fa fa-check"></i><b>30</b> Meta Analysis</a></li>
<li class="chapter" data-level="31" data-path="group-adaptive-sequential-design.html"><a href="group-adaptive-sequential-design.html"><i class="fa fa-check"></i><b>31</b> Group (Adaptive) Sequential Design</a></li>
<li class="chapter" data-level="32" data-path="clinic-study-design.html"><a href="clinic-study-design.html"><i class="fa fa-check"></i><b>32</b> Clinic Study Design</a></li>
<li class="chapter" data-level="33" data-path="propensity-score.html"><a href="propensity-score.html"><i class="fa fa-check"></i><b>33</b> Propensity Score</a></li>
<li class="chapter" data-level="34" data-path="missing-data.html"><a href="missing-data.html"><i class="fa fa-check"></i><b>34</b> Missing Data</a></li>
<li class="chapter" data-level="35" data-path="space.html"><a href="space.html#space"><i class="fa fa-check"></i><b>35</b> ^_^ Space</a></li>
<li class="chapter" data-level="36" data-path="space.html"><a href="space.html#space"><i class="fa fa-check"></i><b>36</b> ^_^ Space</a></li>
<li class="chapter" data-level="37" data-path="space.html"><a href="space.html#space"><i class="fa fa-check"></i><b>37</b> ^_^ Space</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">As a Statistician</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="correlation-and-regression" class="section level1">
<h1><span class="header-section-number">Chapter 18</span> Correlation and Regression</h1>
<div id="correlation" class="section level2">
<h2><span class="header-section-number">18.1</span> Correlation</h2>
<p>The correlation measures the strength of a linear relationship.</p>
<div id="pearson-correlation-coefficient" class="section level3">
<h3><span class="header-section-number">18.1.1</span> Pearson correlation coefficient</h3>
<p>用于量度两个变量X和Y之间的线性相关。它具有+1和-1之间的值，其中1是总正线性相关性，0是非线性相关性，并且-1是总负线性相关性。 Pearson相关系数的一个关键数学特性是它在两个变量的位置和尺度的单独变化下是不变的。也就是说，我们可以将X变换为a+bX并将Y变换为c+dY，而不改变相关系数,其中a，b，c和d是常数，b，d &gt;0。 请注意，更一般的线性变换确实会改变相关性。</p>
<p><span class="math display">\[{\displaystyle \rho _{X,Y}=\operatorname {corr} (X,Y)={\operatorname {cov} (X,Y) \over \sigma _{X}\sigma _{Y}}={\operatorname {E} [(X-\mu _{X})(Y-\mu _{Y})] \over \sigma _{X}\sigma _{Y}}}\]</span></p>
<p><span class="math display">\[{\displaystyle \rho _{X,Y}={\operatorname {E} (XY)-\operatorname {E} (X)\operatorname {E} (Y) \over {\sqrt {\operatorname {E} (X^{2})-\operatorname {E} (X)^{2}}}\cdot {\sqrt {\operatorname {E} (Y^{2})-\operatorname {E} (Y)^{2}}}}}\]</span></p>
<p>积差相关系数的适用条件： 在相关分析中首先要考虑的问题就是两个变量是否可能存在相关关系，如果得到了肯定的结论，那才有必要进行下一步定量的分析。另外还必须注意以下几个问题 (前两者的要求最严，第三条比较宽松，违反时系数的结果也是比较稳健的)：</p>
<ol style="list-style-type: decimal">
<li>积差相关系数适用于线性相关的情形，对于曲线相关等更为复杂的情形，积差相关系数的大小并不能代表相关性的强弱</li>
<li>样本中存在的极端值对Pearson积差相关系数的影响极大，因此要慎重考虑和处理，必要时可以对其进行剔出，或者加以变量变换，以避免因为一两个数值导致出现错误的结论。</li>
<li>Parson积差相关系数要求相应的变量呈双变量正态分布，注意双变量正态分布并非简单的要求x变量和y变量各自服从正态分布，而是要求服从一个联合的双变量正态分布。</li>
<li>Pearson相关系数是在原始数据的方差和协方差基础上计算得到，所以对离群值比较敏感，它度量的是线性相关。因此，即使pearson相关系数为0，也只能说明变量之间不存在线性相关，但仍有可能存在曲线相关。</li>
</ol>
</div>
<div id="spearmans-rank-correlation-coefficient" class="section level3">
<h3><span class="header-section-number">18.1.2</span> Spearman’s rank correlation coefficient</h3>
<p>Spearman相关系数和kendall相关系数都是建立在秩和观测值的相对大小的基础上得到，是一种更为一般性的非参数方法，对离群值的敏感度较低，因而也更具有耐受性，度量的主要是变量之间的联系。</p>
<p>Spearman’s rank correlation利用两变量的秩次大小作线性相关分析，对原始变量的分布不做要求，属于非参数统计方法。 因此它的适用范围比Pearson相关系数要广的多。即使原始数据是等级资料也可以计算Spearman相关系数。对于服从Pearson相关系数的数据也可以计算Spearman相关系数，但统计效能比Pearson相关系数要低一些（不容易检测出两者事实上存在的相关关系）。</p>
<p>如果数据中没有重复值， 并且当两个变量完全单调相关时，斯皮尔曼相关系数则为+1或−1。Spearman相关系数即使出现异常值，由于异常值的秩次通常不会有明显的变化（比如过大或者过小，那要么排第一，要么排最后），所以对Spearman相关性系数的影响也非常小。</p>
<p><span class="math display">\[{\displaystyle r_{s}=\rho _{\operatorname {rg} _{X},\operatorname {rg} _{Y}}={\frac {\operatorname {cov} (\operatorname {rg} _{X},\operatorname {rg} _{Y})}{\sigma _{\operatorname {rg} _{X}}\sigma _{\operatorname {rg} _{Y}}}}}\]</span></p>
</div>
<div id="kendall-rank-correlation-coefficient" class="section level3">
<h3><span class="header-section-number">18.1.3</span> Kendall rank correlation coefficient</h3>
<p>Kendall秩相关系数: 是一种秩相关系数，用于反映分类变量相关性的指标，适用于两个变量均为有序分类的情况.
用希腊字母<span class="math inline">\(\tau\)</span>表示其值.Kendall相关系数的取值范围在-1到1之间，当<span class="math inline">\(\tau\)</span>为1时，表示两个随机变量拥有一致
的等级相关性；当<span class="math inline">\(\tau\)</span>为-1时，表示两个随机变量拥有完全相反的等级相关性；当<span class="math inline">\(\tau\)</span>为0时，表示两个随机变量
是相互独立的。</p>
<p>计算公式：Kendall系数是基于协同的思想。对于X,Y的两对观察值<span class="math inline">\(Xi\)</span>,<span class="math inline">\(Yi\)</span>和<span class="math inline">\(X_j\)</span>,<span class="math inline">\(Y_j\)</span>,如果<span class="math inline">\(X_j&gt;Y_j\)</span>,则称这
两对观察值是和谐的,否则就是不和谐。(和谐的观察值对减去不和谐的观察值对的数量,除以总的观察值对数.), kendall相关系数的计算公式如下:</p>
<p><span class="math display">\[{\displaystyle \tau ={\frac {({\text{number of concordant pairs}})-({\text{number of discordant pairs}})}{n \choose 2}}}\]</span></p>
<p><span class="math inline">\({\displaystyle {n \choose 2}={n(n-1) \over 2}}\)</span> is the binomial coefficient for the number of ways to
choose two items from n items.</p>
</div>
<div id="intraclass-correlation" class="section level3">
<h3><span class="header-section-number">18.1.4</span> Intraclass correlation</h3>
<p>当对组织成组的单元进行定量测量时，可以使用该描述性统计。 它描述了同一组中的单元彼此相似的程度。 尽管它被视为一种相关类型，但与大多数其他相关度量不同的是，它对以组为结构的数据进行操作，而不是对以
成对观测值进行结构化的数据。组内相关系数(Intraclass correlation coefficient,ICC) 常用于评价具有某种确定亲属关系的个体间某定量属性的相似程度，另一方面主要应用于评价不同测定方法或
评定者对同一定量测量结果的一致性或可靠性。</p>
<p>就其代数形式而言，费舍尔最初的ICC是最类似于Pearson相关系数的ICC。两种统计数据之间的主要区别在于，
在ICC中，数据使用合并的平均值和标准偏差进行居中和缩放。
对于ICC来说，这种合并缩放是有意义的，因为所有测量的数量都是相同的（尽管在不同组中的单位上）。</p>
<p><span class="math display">\[{\displaystyle r={\frac {1}{Ns^{2}}}\sum _{n=1}^{N}(x_{n,1}-{\bar {x}})(x_{n,2}-{\bar {x}}),}\]</span>
<span class="math display">\[{\displaystyle {\bar {x}}={\frac {1}{2N}}\sum _{n=1}^{N}(x_{n,1}+x_{n,2}),}\]</span>
<span class="math display">\[{\displaystyle s^{2}={\frac {1}{2N}}\left\{\sum _{n=1}^{N}(x_{n,1}-{\bar {x}})^{2}+\sum _{n=1}^{N}(x_{n,2}-{\bar {x}})^{2}\right\}.}\]</span>
在Pearson相关中，每个变量均通过其自身的平均值和标准偏差来居中和缩放。
<span class="math display">\[r_{x y}=\frac{\sum_{i=1}^{n}\left(x_{i}-\bar{x}\right)\left(y_{i}-\bar{y}\right)}{\sqrt{\sum_{i=1}^{n}\left(x_{i}-\bar{x}\right)^{2}} \sqrt{\sum_{i=1}^{n}\left(y_{i}-\bar{y}\right)^{2}}}\]</span></p>
</div>
<div id="visualize-the-correlation-in-r" class="section level3">
<h3><span class="header-section-number">18.1.5</span> Visualize the correlation in R</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="correlation-and-regression.html#cb1-1"></a>bank&lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb1-2"><a href="correlation-and-regression.html#cb1-2"></a>  <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">1018.4</span>,<span class="fl">1258.9</span>,<span class="fl">1359.4</span>,<span class="fl">1545.6</span>,<span class="fl">1761.6</span>,<span class="fl">1960.8</span>),</span>
<span id="cb1-3"><a href="correlation-and-regression.html#cb1-3"></a>  <span class="dt">x1=</span><span class="kw">c</span>(<span class="dv">159</span>,<span class="dv">42</span>,<span class="dv">95</span>,<span class="dv">102</span>,<span class="dv">104</span>,<span class="dv">108</span>),</span>
<span id="cb1-4"><a href="correlation-and-regression.html#cb1-4"></a>  <span class="dt">x2=</span><span class="kw">c</span>(<span class="fl">223.1</span>,<span class="fl">269.4</span>,<span class="fl">297.1</span>,<span class="fl">330.1</span>,<span class="fl">337.9</span>,<span class="fl">400.5</span>),</span>
<span id="cb1-5"><a href="correlation-and-regression.html#cb1-5"></a>  <span class="dt">x3=</span><span class="kw">c</span>(<span class="dv">500</span>,<span class="dv">370</span>,<span class="dv">430</span>,<span class="dv">390</span>,<span class="dv">330</span>,<span class="dv">310</span>),</span>
<span id="cb1-6"><a href="correlation-and-regression.html#cb1-6"></a>  <span class="dt">x4=</span><span class="kw">c</span>(<span class="fl">112.3</span>,<span class="fl">146.4</span>,<span class="fl">119.9</span>,<span class="fl">117.8</span>,<span class="fl">122.3</span>,<span class="fl">167.0</span>),</span>
<span id="cb1-7"><a href="correlation-and-regression.html#cb1-7"></a>  <span class="dt">w=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">8</span>)</span>
<span id="cb1-8"><a href="correlation-and-regression.html#cb1-8"></a>)</span>
<span id="cb1-9"><a href="correlation-and-regression.html#cb1-9"></a><span class="kw">cor</span>(bank[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)],<span class="dt">method =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<pre><code>##            x1         x2         x3         x4
## x1  1.0000000 -0.1604025  0.5095785 -0.4331830
## x2 -0.1604025  1.0000000 -0.8558009  0.5987314
## x3  0.5095785 -0.8558009  1.0000000 -0.7010598
## x4 -0.4331830  0.5987314 -0.7010598  1.0000000</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="correlation-and-regression.html#cb3-1"></a><span class="co">## Visualize the correlation matrix</span></span>
<span id="cb3-2"><a href="correlation-and-regression.html#cb3-2"></a><span class="kw">library</span>(corrplot)</span>
<span id="cb3-3"><a href="correlation-and-regression.html#cb3-3"></a>bank.cor &lt;-<span class="st"> </span><span class="kw">cor</span>(bank)</span>
<span id="cb3-4"><a href="correlation-and-regression.html#cb3-4"></a><span class="kw">corrplot</span>(bank.cor, <span class="dt">method =</span> <span class="st">&quot;ellipse&quot;</span>)</span>
<span id="cb3-5"><a href="correlation-and-regression.html#cb3-5"></a></span>
<span id="cb3-6"><a href="correlation-and-regression.html#cb3-6"></a></span>
<span id="cb3-7"><a href="correlation-and-regression.html#cb3-7"></a><span class="co">## devtools::install_github(&quot;kassambara/ggcorrplot&quot;)</span></span>
<span id="cb3-8"><a href="correlation-and-regression.html#cb3-8"></a><span class="kw">library</span>(ggplot2)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/Corrplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="correlation-and-regression.html#cb4-1"></a><span class="kw">library</span>(ggcorrplot)</span>
<span id="cb4-2"><a href="correlation-and-regression.html#cb4-2"></a></span>
<span id="cb4-3"><a href="correlation-and-regression.html#cb4-3"></a><span class="co">## Correlation matrix</span></span>
<span id="cb4-4"><a href="correlation-and-regression.html#cb4-4"></a><span class="kw">data</span>(mtcars)</span>
<span id="cb4-5"><a href="correlation-and-regression.html#cb4-5"></a>corr &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">cor</span>(mtcars), <span class="dv">1</span>)</span>
<span id="cb4-6"><a href="correlation-and-regression.html#cb4-6"></a></span>
<span id="cb4-7"><a href="correlation-and-regression.html#cb4-7"></a><span class="co">## Plot</span></span>
<span id="cb4-8"><a href="correlation-and-regression.html#cb4-8"></a><span class="kw">ggcorrplot</span>(corr, <span class="dt">hc.order =</span> <span class="ot">TRUE</span>, </span>
<span id="cb4-9"><a href="correlation-and-regression.html#cb4-9"></a>           <span class="dt">type =</span> <span class="st">&quot;lower&quot;</span>, </span>
<span id="cb4-10"><a href="correlation-and-regression.html#cb4-10"></a>           <span class="dt">lab =</span> <span class="ot">TRUE</span>, </span>
<span id="cb4-11"><a href="correlation-and-regression.html#cb4-11"></a>           <span class="dt">lab_size =</span> <span class="dv">3</span>, </span>
<span id="cb4-12"><a href="correlation-and-regression.html#cb4-12"></a>           <span class="dt">method=</span><span class="st">&quot;circle&quot;</span>, </span>
<span id="cb4-13"><a href="correlation-and-regression.html#cb4-13"></a>           <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;tomato2&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;springgreen3&quot;</span>), </span>
<span id="cb4-14"><a href="correlation-and-regression.html#cb4-14"></a>           <span class="dt">title=</span><span class="st">&quot;Correlogram of mtcars&quot;</span>, </span>
<span id="cb4-15"><a href="correlation-and-regression.html#cb4-15"></a>           <span class="dt">ggtheme=</span>theme_bw)</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/Corrplot-2.png" width="672" /></p>
</div>
</div>
<div id="ordinary-least-squares-ols" class="section level2">
<h2><span class="header-section-number">18.2</span> Ordinary least squares (OLS)</h2>
<div id="assumpions" class="section level3">
<h3><span class="header-section-number">18.2.1</span> Assumpions</h3>
<p><span class="math display">\[{\displaystyle \mathbf {y} =\mathbf {X} {\boldsymbol {\beta }}+{\boldsymbol {\varepsilon }}\;}  \ \ \ \ {\displaystyle \;{\boldsymbol {\varepsilon }}\sim {\mathcal {N}}(\mathbf {0} ,\sigma ^{2}\mathbf {I} _{T})}.\]</span>
1. <span class="math inline">\(y_{i}=\alpha+\beta x_{i}+\varepsilon_{i}\)</span>
2. <span class="math inline">\(\mathrm{E}\left(\varepsilon_{i}\right)=0\)</span>
3. <span class="math inline">\(\operatorname{var}\left(\varepsilon_{i}\right)=\sigma^{2}\)</span>
4. <span class="math inline">\(\operatorname{cov}\left(\varepsilon_{i}, \varepsilon_{j}\right)=0\)</span>
5. <span class="math inline">\(\varepsilon_{i} \sim\)</span> Normal Distribution</p>
</div>
<div id="interpretation" class="section level3">
<h3><span class="header-section-number">18.2.2</span> Interpretation</h3>
<ul>
<li>Linearity: The relationship between the predictor variable and the response variable is linear. If the linear relationship cannot be clearly presented, <strong>data conversion</strong> (logarithmic conversion, polynomial conversion, exponential conversion, etc.) can be performed on the variable X or Y</li>
<li>Residuals are uncorrelated</li>
<li>Homoscedasticity: The errors are normally distributed and have the same variance. This means that for different input values, the variance of the error is a fixed value. If this hypothesis is violated, the parameter estimation may be biased, leading to the statistical test result of significance is too high or too low, and thus get wrong conclusions. This situation is called heteroscedasticity.
<ul>
<li>同方差性:误差是正态分布的，并具有相同的方差。这意味着对于不同的输入值，误差 的方差是个固定值。如果违背了这个假设，参数估计就有可能产生偏差，导致对显著性 的统计检验结果过高或者过低，从而得到错误的结论。这种情况就称为异方差性。</li>
</ul></li>
<li>on-collinearity: There is no linear relationship between the two predictors, that is, there should be no correlation between the features. Similarly, collinearity can also cause estimation bias.</li>
<li>Outliers: outliers will seriously affect parameter estimation. Ideally, outliers must be removed before using linear regression to fit the model.</li>
</ul>
</div>
<div id="section" class="section level3">
<h3><span class="header-section-number">18.2.3</span> </h3>
<p>Least squares method minimum <span class="math inline">\(J\left(\theta_{0}, \theta_{1}\right)\)</span> and find out the smallest <span class="math inline">\(\theta_{0}\)</span> and <span class="math inline">\(\theta_{1}\)</span></p>
<p><span class="math display">\[J(\theta_0, \theta_1) = \sum\limits_{i=1}^{m}(y^{(i)} - h_\theta(x^{(i)})^2 = \sum\limits_{i=1}^{m}(y^{(i)} -  \theta_0 - \theta_1 x^{(i)})^2\]</span></p>
<p>Assume <span class="math display">\[h_\theta(x_1, x_2, ...x_n) = \theta_0 + \theta_{1}x_1 + ... + \theta_{n}x_{n}\]</span> as <span class="math display">\[h_\mathbf{\theta}(\mathbf{x}) = \mathbf{X\theta}\]</span></p>
<p><span class="math display">\[J(\mathbf\theta) = \frac{1}{2}(\mathbf{X\theta} - \mathbf{Y})^T(\mathbf{X\theta} - \mathbf{Y})\]</span></p>
<p>Take the derivative of the θ vector for this loss function to 0</p>
<p><span class="math display">\[\frac{\partial}{\partial\mathbf\theta}J(\mathbf\theta) = \mathbf{X}^T(\mathbf{X\theta} - \mathbf{Y}) = 0\]</span>
<span class="math display">\[\mathbf{X^{T}X\theta} = \mathbf{X^{T}Y}\]</span>
<span class="math display">\[\mathbf{\theta} = (\mathbf{X^{T}X})^{-1}\mathbf{X^{T}Y}\]</span></p>
</div>
<div id="gauss-markov-theorem" class="section level3">
<h3><span class="header-section-number">18.2.4</span> Gauss-Markov Theorem</h3>
<p>高斯马尔科夫定理（Gauss-Markov Theorem）证明了最小二乘法线性有特别好的性质，具体来说，当误差项均值为 0 时，OLS 得到的无偏<span class="math inline">\(\hat \beta\)</span>（unbiased），如果各误差项方差相同，OLS 得到的是最佳无偏线性估计（BLUE, best linear unbiased estimator）。如果线性回归模型中的误差不相关，则普通最小二乘（OLS）估计量在线性无偏估计量类别中的抽样方差最低. <span class="math inline">\(\hat \beta\)</span>是一个合理的估计量，但也有其他选择。 但是，使用最小二乘有三个良好的理由：</p>
<ol style="list-style-type: decimal">
<li>It results from an orthogonal projection onto the model space. It makes sense geometrically.</li>
<li>If the errors are independent and identically normally distributed, it is the maximum likelihood estimator. Loosely put, the maximum likelihood estimate is the value of <span class="math inline">\(\hat \beta\)</span> that maximizes the probability of the data that was observed. (如果误差是独立的并且正态分布相同，则它是最大似然估计量。 松散地说，最大似然估计值为 这样可以最大程度地提高观察到数据的可能性。)</li>
<li>The Gauss-Markov theorem states that is the best linear unbiased estimate (BLUE).</li>
</ol>
</div>
<div id="limitation" class="section level3">
<h3><span class="header-section-number">18.2.5</span> limitation</h3>
<ol style="list-style-type: decimal">
<li>首先, 最小二乘法需要计算 <span class="math inline">\(\left(\mathbf{X}^{\mathrm{T}} \mathbf{X}\right)\)</span> 的逆矩阵, 有可能它的逆 矩阵 <span class="math inline">\(\left(\mathbf{X}^{\mathrm{T}} \mathbf{X}\right)^{-1}\)</span> 不存在, 这样就没有办法直接用最小二王法 了，此时梯度下降法仍然可以使用。当然，我们可以通过对样 本数据进行整理, 去掉几余特征。让 <span class="math inline">\(\left(\mathbf{X}^{\mathrm{T}} \mathbf{X}\right)\)</span> 的行列式不为 0, 然后继续使用最小二乘法。</li>
<li>第二，当样本特征n非常的大的时候, 计算 <span class="math inline">\(\left(\mathbf{X}^{\mathrm{T}} \mathbf{X}\right)\)</span> 的逆矩阵 是一个非常耗时的工作 (nxn的矩阵求逆)， 甚至不可行。此时 以梯度下降为代表的迭代法仍然可以使用。那这个n到底多大就 不适合最小二乘法呢? 如果你没有很多的分布式大数据计算资 源, 建议超过10000个特征就用迭代法吧。或者通过主成分分 析降低特征的维度后再用最小二乘法。</li>
<li>第三，如果拟合函数不是线性的，这时无法使用最小二乘法,需要通过一些技巧转化为线性才能使用，此时梯度下降仍然可以用。</li>
<li>第四, 特死情况。当样本量m很少，小于特征数n的时候，这时 拟合方程是欠定的，常用的优化方法都无法去拟合数据。当样 本量m等于特征数n的时候, 用方程组求解就可以了。当m大于 n时，拟合方程是超定的, 也就是我们常用与最小二乘法的场景。</li>
</ol>
</div>
</div>
<div id="model-statistics" class="section level2">
<h2><span class="header-section-number">18.3</span> Model Statistics</h2>
<div id="residuals-standard-error" class="section level3">
<h3><span class="header-section-number">18.3.1</span> Residuals Standard Error</h3>
<pre><code>## Build Model
y &lt;- c(8.04,6.95,7.58,8.81,8.33,9.96,7.24,4.26,10.84,4.82,5.68)
x1 &lt;- c(10,8,13,9,11,14,6,4,12,7,5)
set.seed(15)
x2 &lt;- sqrt(y)+rnorm(length(y))
model &lt;- lm(y~x1+x2)

## Residual Standard error (Like Standard Deviation)
k &lt;- length(model$coefficients)-1  # Subtract one to ignore intercept
SSE &lt;- sum(model$residuals**2)
n &lt;- length(model$residuals)
Residual_Standard_Error &lt;- sqrt(SSE/(n-(1+k)))</code></pre>
</div>
<div id="r-squared-and-adjusted-r-squared" class="section level3">
<h3><span class="header-section-number">18.3.2</span> R-Squared and Adjusted R-Squared</h3>
<p><strong>R-Squared Calculation</strong></p>
<p>R<sup>2</sup> is a statistic that will give some information about the goodness of fit of a model. In regression, the R<sup>2</sup> coefficient of determination is a statistical measure of how well the regression predictions approximate the real data points. An R<sup>2</sup> of 1 indicates that the regression predictions perfectly fit the data.</p>
<p>The total sum of squares
<span class="math display">\[{\displaystyle SS_{\text{tot}}=\sum _{i}(y_{i}-{\bar {y}})^{2}}\]</span>
The sum of squares of residuals
<span class="math display">\[{\displaystyle SS_{\text{res}}=\sum _{i}(y_{i}-f_{i})^{2}=\sum _{i}e_{i}^{2}\,}\]</span>
<span class="math display">\[{\displaystyle R^{2}=1-{SS_{\rm {res}} \over SS_{\rm {tot}}}\,}\]</span></p>
<pre><code>## Build Model
y &lt;- c(8.04,6.95,7.58,8.81,8.33,9.96,7.24,4.26,10.84,4.82,5.68)
x1 &lt;- c(10,8,13,9,11,14,6,4,12,7,5)
set.seed(15)
x2 &lt;- sqrt(y)+rnorm(length(y))
model &lt;- lm(y~x1+x2)

## Multiple R-Squared
SSyy &lt;- sum((y-mean(y))**2)
SSE &lt;- sum(model$residuals**2)

(SSyy-SSE)/SSyy
 
# Alternatively
1-SSE/SSyy</code></pre>
<p><strong>Adjusted R-Squared</strong></p>
<p>Adjusted R-Squared normalizes Multiple R-Squared by taking into account how many samples you have and how many variables you’re using.</p>
<p><span class="math display">\[{\displaystyle {\bar {R}}^{2}=1-(1-R^{2}){n-1 \over n-p-1}}\]</span></p>
<pre><code>## Adjusted R-Squared
n &lt;- length(y)
k &lt;- length(model$coefficients)-1  # Subtract one to ignore intercept
SSE &lt;- sum(model$residuals**2)
SSyy &lt;- sum((y-mean(y))**2)
1-(SSE/SSyy)*(n-1)/(n-(k+1))</code></pre>
</div>
<div id="t-statistic" class="section level3">
<h3><span class="header-section-number">18.3.3</span> T Statistic</h3>
<p>Null Hypothesis is that the coefficients associated with the variables is equal to zero. The alternate hypothesis is that the coefficients are not equal to zero (i.e. there exists a relationship between the independent variable in question and the dependent variable).</p>
<p>We can interpret the t-value something like this. A larger t-value indicates that it is less likely that the coefficient is not equal to zero purely by chance. So, higher the t-value, the better.</p>
<p>Pr(&gt;|t|) or p-value is the probability that you get a t-value as high or higher than the observed value when the Null Hypothesis (the β coefficient is equal to zero or that there is no relationship) is true. So if the Pr(&gt;|t|) is low, the coefficients are significant (significantly different from zero). If the Pr(&gt;|t|) is high, the coefficients are not significant.</p>
<p><span class="math display">\[t−Statistic = {β−coefficient \over Std.Error}\]</span></p>
</div>
<div id="f-statistic" class="section level3">
<h3><span class="header-section-number">18.3.4</span> F Statistic</h3>
<p><span class="math inline">\(\mathrm{H}_{0}: \beta_{1}=\ldots \beta_{\mathrm{p}-1}=0\)</span></p>
<p><span class="math display">\[Std. Error = \sqrt{MSE} = \sqrt{\frac{SSE}{n-q}}\]</span>
<span class="math display">\[MSR=\frac{\sum_{i}^{n}\left( \hat{y_{i} - \bar{y}}\right)}{q-1} = \frac{SST - SSE}{q - 1}\]</span>
<span class="math display">\[F-statistic = \frac{MSR}{MSE}\]</span></p>
<pre><code>linearMod &lt;- lm(dist ~ speed, data=cars)
modelSummary &lt;- summary(linearMod)  # capture model summary as an object
modelCoeffs &lt;- modelSummary$coefficients  # model coefficients
beta.estimate &lt;- modelCoeffs[&quot;speed&quot;, &quot;Estimate&quot;]  # get beta estimate for speed
std.error &lt;- modelCoeffs[&quot;speed&quot;, &quot;Std. Error&quot;]  # get std.error for speed

t_value &lt;- beta.estimate/std.error  # calc t statistic

p_value &lt;- 2*pt(-abs(t_value), df=nrow(cars)-ncol(cars))  # calc p Value

f_statistic &lt;- modelSummary$fstatistic[1]  # fstatistic

f &lt;- summary(linearMod)$fstatistic  # parameters for model p-value calc
model_p &lt;- pf(f[1], f[2], f[3], lower=FALSE)


## For Calculation
data(savings)
g &lt; - 1m (sr ˜ pop15 + pop75 + dpi + ddpi, savings)
summary (g)

## Test Beta1 = Beta2 = Beta3 = Beta4 = 0
(tss &lt; - sum((savings$sr-mean (savings$sr))^2))
(rss &lt; - deviance(g))
(fstat &lt; - ((tss-rss)/4)/(rss/df.residual(g)))
## F Test
1-pf (fstat, 4, df.residual (g)) </code></pre>
<p><strong>Model Comparasion</strong></p>
<pre><code>g2 &lt; - 1m (sr ˜ pop75 + dpi + ddpi, savings)

## d compute the RSS and the F-statistic:
(rss2 &lt; - deviance (g2))
(fstat &lt; - (deviance (g2)-deviance (g))/(deviance (g)/df.residual(g)))
## P value
1-pf (fstat, l, df.residual(g))

## relate this to the t-based test and p-value by:
sqrt (fstat) 
(tstat &lt; - summary(g)$coef[2, 3])
2 * (l-pt (sqrt (fstat), 45))

## more convenient way to compare two nested models is:
anova (g2, g)

## Analysis of Variance Table
## Model 1: sr ˜ pop75 + dpi + ddpi
## Model 2: sr ˜ pop15 + pop75 + dpi + ddpi</code></pre>
</div>
<div id="confidence-intervals" class="section level3">
<h3><span class="header-section-number">18.3.5</span> Confidence Intervals</h3>
<p><strong>Confidence Intervals for <span class="math inline">\(\beta\)</span></strong></p>
<p><span class="math display">\[\hat{\beta}_{i} \pm t_{n-p}^{(\alpha / 2)} \hat{\sigma} \sqrt{\left(X^{T} X\right)_{i i}^{-1}}\]</span></p>
<p>Alternatively, a <span class="math inline">\(100(1-\alpha) \%\)</span> confidence region for <span class="math inline">\(\beta\)</span> satisfies:</p>
<p><span class="math display">\[(\hat{\beta}-\beta)^{T} X^{T} X(\hat{\beta}-\beta) \leq p \hat{\sigma}^{2} F_{p, n-p}^{(\alpha)}\]</span></p>
<p><strong>Confidence Intervals for Predictions</strong></p>
<p>必须区分对未来均值响应的预测和对未来观测值的预测。</p>
<ol style="list-style-type: decimal">
<li>Suppose a specific house comes on the market with characteristics <span class="math inline">\(x_{0}\)</span>. Its selling price will be <span class="math inline">\(x_{0}^{T} \beta+\varepsilon\)</span> since <span class="math inline">\(\mathrm{E} \varepsilon=0\)</span>, the predicted price is <span class="math inline">\(x_{0}^{T} \hat{\beta}\)</span> but in assessing the variance of this
prediction, we must include the variance of <span class="math inline">\(\varepsilon .\)</span> (评估此预测的方差时，我们必须包括 <span class="math inline">\(\varepsilon\)</span> 的方差 <span class="math inline">\(_{\circ}\)</span> )</li>
<li>Suppose we ask the question - What would a house with characteristics <span class="math inline">\(x_{0}\)</span> sell for on average?" This selling price is <span class="math inline">\(x_{0}^{T} \beta\)</span> and is again predicted by <span class="math inline">\(x_{0}^{T} \hat{\beta}\)</span> but now only the variance in <span class="math inline">\(\hat{\beta}\)</span> needs to be taken into account.(平均售价只需要考虑 <span class="math inline">\(\hat{\beta}\)</span> 的方差)</li>
</ol>
<p>A 100(1–%) % CI for a single future response is:<span class="math display">\[\hat{y}_{0} \pm t_{n-p}^{(\alpha / 2)} \hat{\sigma} \sqrt{1+x_{0}^{T}\left(X^{T} X\right)^{-1} x_{0}}\]</span></p>
<p>A CI for the mean response for given <span class="math inline">\(x_0\)</span> is <span class="math display">\[\hat{y}_{0} \pm t_{n-p}^{(\alpha / 2)} \hat{\sigma} \sqrt{x_{0}^{T}\left(X^{T} X\right)^{-1} x_{0}}\]</span></p>
</div>
<div id="likelihood-ratio-test" class="section level3">
<h3><span class="header-section-number">18.3.6</span> Likelihood-ratio test</h3>
<p>likelihood-ratio test assesses the goodness of fit of two competing statistical models based on the ratio of their likelihoods, specifically one found by maximization over the entire parameter space and another found after imposing some constraint. If the constraint (i.e., the null hypothesis) is supported by the observed data, the two likelihoods should not differ by more than sampling error.</p>
<p>Suppose that we have a statistical model with parameter space <span class="math inline">\({\displaystyle \Theta }\)</span>.</p>
<ul>
<li>A null hypothesis is often stated by saying that the parameter <span class="math inline">\({\displaystyle \theta }\)</span> is in a specified subset <span class="math inline">\({\displaystyle \Theta _{0}}\)</span> of <span class="math inline">\({\displaystyle \Theta }\)</span>.</li>
<li>The alternative hypothesis is thus that <span class="math inline">\({\displaystyle \theta }\)</span> is in the complement of <span class="math inline">\({\displaystyle \Theta _{0}}\)</span></li>
</ul>
<p><span class="math display">\[{\displaystyle \lambda _{\text{LR}}=-2\ln \left[{\frac {~\sup _{\theta \in \Theta _{0}}{\mathcal {L}}(\theta )~}{~\sup _{\theta \in \Theta }{\mathcal {L}}(\theta )~}}\right]}\]</span></p>
<p>Often the likelihood-ratio test statistic is expressed as a difference between the log-likelihoods
<span class="math display">\[{\displaystyle \lambda _{\text{LR}}=-2\left[~\ell (\theta _{0})-\ell ({\hat {\theta }})~\right]}\]</span>
<span class="math display">\[{\displaystyle \ell ({\hat {\theta }})\equiv \ln \left[~\sup _{\theta \in \Theta }{\mathcal {L}}(\theta )~\right]~}\]</span></p>
</div>
<div id="accuracy" class="section level3">
<h3><span class="header-section-number">18.3.7</span> Accuracy</h3>
<p><strong>Accuracy</strong>: A simple correlation between the actuals and predicted values can be used as a form of accuracy measure. A higher correlation accuracy implies that the actuals and predicted values have similar directional movement, i.e. when the actuals values increase the predicteds also increase and vice-versa.
<span class="math display">\[\text{Min Max Accuracy} = mean \left( \frac{min\left(actuals, predicteds\right)}{max\left(actuals, predicteds \right)} \right)\]</span>
<span class="math display">\[\text{Mean Absolute Percentage Error \ (MAPE)} = mean\left( \frac{abs\left(predicteds−actuals\right)}{actuals}\right)\]</span></p>
<pre><code>Step 1: Create the training (development) and test (validation) data samples from original data.
Step 2: Develop the model on the training data and use it to predict the distance on test data
Step 3: Review diagnostic measures.
Step 4: Calculate prediction accuracy and error rates

# Create Training and Test data -
set.seed(100)  # setting seed to reproduce results of random sampling
trainingRowIndex &lt;- sample(1:nrow(cars), 0.8*nrow(cars))  # row indices for training data
trainingData &lt;- cars[trainingRowIndex, ]  # model training data
testData  &lt;- cars[-trainingRowIndex, ]   # test data

# Build the model on training data -
lmMod &lt;- lm(dist ~ speed, data=trainingData)  # build the model
distPred &lt;- predict(lmMod, testData)  # predict distance

# Review diagnostic measures.
summary (lmMod)  # model summary
AIC (lmMod)  # Calculate akaike information criterion

# Calculate prediction accuracy and error rates
actuals_preds &lt;- data.frame(cbind(actuals=testData$dist, predicteds=distPred))  # make actuals_predicteds dataframe.
correlation_accuracy &lt;- cor(actuals_preds)  
correlation_accuracy

# Now lets calculate the Min Max accuracy and MAPE:
# 计算最小最大精度和MAPE：
min_max_accuracy &lt;- mean(apply(actuals_preds, 1, min) / apply(actuals_preds, 1, max))  
min_max_accuracy

# Mean Absolute Percentage Error 
mape &lt;- mean(abs((actuals_preds$predicteds - actuals_preds$actuals))/actuals_preds$actuals)  
mape</code></pre>
</div>
</div>
<div id="model-diagnostics" class="section level2">
<h2><span class="header-section-number">18.4</span> Model Diagnostics</h2>
<p>The estimation and inference of the regression model depend on several assumptions. These assumptions need to be checked using regression diagnostics. We divide potential problems into three categories:</p>
<ol style="list-style-type: decimal">
<li>Error We have assumed that <span class="math inline">\(\varepsilon \sim \mathrm{N}\left(0, \sigma^{2} I\right)\)</span> or in words, that the errors are independent, have equal variance and are normally distributed.</li>
<li>Model We have assumed that the structural part of the model <span class="math inline">\(E y=X \beta\)</span> is correct.</li>
<li>Unusual observations Sometimes just a few observations do
not fit the model. These few observations might change the
choice and fit of the model.</li>
</ol>
<div id="checking-error-assumptions" class="section level3">
<h3><span class="header-section-number">18.4.1</span> Checking Error Assumptions</h3>
<p><strong>1. Constant Variance (Residuals vs. fitted plots)</strong></p>
<p>There are two approaches to dealing with nonconstant variance. Use of <strong>weighted least squares</strong> is appropriate when the form of the <strong>nonconstant variance</strong> is either known exactly or there is some known parametric form. Alternatively, one can transform the variables.</p>
<p><strong>Assumptions Checks using Residual Plots</strong></p>
<p>In order for the model to accurately explain the data and for your p-value to represent a meaningful test of the null hypothesis, we need to make some assumptions about the data. Many diagnostics about the regression model can be derived using plots of the residuals of the fitted model. The residuals can easily be obtained and examined, but the crucial concept is that these are sampled from a larger, unobservable population</p>
<blockquote>
<p>为了使模型准确地解释数据并让您的p值代表对原假设的有意义的检验，我们需要对数据进行一些假设。 可以使用拟合模型的残差图得出有关回归模型的许多诊断信息。 残差可以很容易地获得和检查，但是关键的概念是，这些残差是从一个较大的，不可观察的人群中取样的</p>
</blockquote>
<p><strong>The model assumptions are expressed in terms of the error distribution.</strong></p>
<ol style="list-style-type: decimal">
<li>Errors are independent</li>
<li>Errors have constant variance</li>
<li>Errors have mean zero</li>
<li>Errors follow a normal distribution</li>
</ol>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="02_Plots/LR_Residums.png" alt="Figure: Residums Plots" width="100%" />
<p class="caption">
Figure 18.1: Figure: Residums Plots
</p>
</div>
<p>Hier some plots can be used:</p>
<ul>
<li>Scatter plot: 可视化预测变量和响应之间的线性关系</li>
<li>Box plot: 在变量中发现任何异常值。在预测变量中包含异常值会极大地影响预测，因为它们很容易影响最佳拟合线的方向/斜率。</li>
<li>Density plot: 查看预测变量的分布。理想情况下，接近正态分布（钟形曲线）且不偏向左侧或右侧是首选。</li>
<li>Bubble plot: 气泡图是散点图的变体，其中 数据点 替换为气泡，数据的其他维度以气泡大小表示。 与散点图一样，气泡图不使用分类轴 - 水平坐标轴和垂直坐标轴都是数值轴。 除了绘制在散点图中的 x 值和 y 值之外，气泡图还绘制 x 值、y 值和 z (大小) 值。</li>
</ul>
<p><strong>Scatter plots</strong></p>
<p>Scatter plots can help visualize any linear relationships between the dependent (response) variable and independent (predictor) variables. Ideally, if you are having multiple predictor variables, a scatter plot is drawn for each one of them against the response, along with the line of best as seen below. <a href="https://drsimonj.svbtle.com/visualising-residuals">Residuals</a></p>
<pre><code>scatter.smooth(x=cars$speed, y=cars$dist, main=&quot;Dist ~ Speed&quot;)</code></pre>
<p><strong>Box Plot</strong></p>
<p>Check for outliers. Generally, any data point outside the 1.5 quartile range (1.5 IQR) is considered an outlier, where IQR is calculated as the 25th percentile and 75th percentile of the variable the distance between.</p>
<pre><code>par(mfrow=c(1, 2))  # divide graph area in 2 columns
boxplot(cars$speed, main=&quot;Speed&quot;, sub=paste(&quot;Outlier rows: &quot;, boxplot.stats(cars$speed)$out))  # box plot for &#39;speed&#39;
boxplot(cars$dist, main=&quot;Distance&quot;, sub=paste(&quot;Outlier rows: &quot;, boxplot.stats(cars$dist)$out))  # box plot for &#39;distance&#39;</code></pre>
<p><strong>Density plot</strong></p>
<p>Check if the response variable is close to normality</p>
<pre><code>library(e1071)
par(mfrow=c(1, 2))  # divide graph area in 2 columns
plot(density(cars$speed), main=&quot;Density Plot: Speed&quot;, ylab=&quot;Frequency&quot;, sub=paste(&quot;Skewness:&quot;, round(e1071::skewness(cars$speed), 2)))  # density plot for &#39;speed&#39;
polygon(density(cars$speed), col=&quot;red&quot;)
plot(density(cars$dist), main=&quot;Density Plot: Distance&quot;, ylab=&quot;Frequency&quot;, sub=paste(&quot;Skewness:&quot;, round(e1071::skewness(cars$dist), 2)))  # density plot for &#39;dist&#39;
polygon(density(cars$dist), col=&quot;red&quot;)</code></pre>
<p><strong>2. Normality</strong></p>
<p>The residuals can be assessed for normality using a Q–Q plot</p>
<p>When the errors are not normal, least squares estimates may not be optimal. They will still be best linear unbiased estimates, but other robust estimators may be more effective. Also tests and confidence intervals are not exact. However, only long-tailed distributions cause large inaccuracies. Mild nonnormality can safely be ignored and the larger the sample size the less troublesome the nonnormality. For short-tailed distributions, the consequences of nonnormality are not serious and can reasonably</p>
<!-- 当误差不正常时，最小二乘估计可能不是最佳的。 它们仍将是最佳的线性无偏估计，但其他稳健的估计量可能更有效。 同样，测试和置信区间也不精确。 但是，只有长尾分布会导致较大的误差。 轻度的非正常现象可以安全地忽略，样本量越大，非正常现象的麻烦就越小。对于短尾分布，非正态性的后果并不严重，并且可以合理地进行。 -->
<p>The Shapiro-Wilk test is a formal test for normality, The null hypothesis is that the the residuals are normal.:</p>
<pre><code>shapiro.test (residuals (g))</code></pre>
<p><strong>3. Correlated Errors</strong></p>
<p>Graphical checks include plots of <span class="math inline">\(\hat{\varepsilon}\)</span> against time and
<span class="math inline">\(\hat{\varepsilon}_{i}\)</span> against <span class="math inline">\(\hat{\varepsilon}_{i-1}\)</span> while the Durbin Watson test uses the statistic (The null distribution based on the assumption of uncorrelated errors follows a linear combination of <span class="math inline">\(\chi^{2}\)</span>
distributions.):
<span class="math display">\[
D W=\frac{\sum_{i=2}^{n}\left(\hat{\varepsilon}_{i}-\hat{\varepsilon}_{i-1}\right)^{2}}{\sum_{i=1}^{n} \hat{\varepsilon}_{i}^{2}}
\]</span></p>
</div>
<div id="finding-unusual-observations" class="section level3">
<h3><span class="header-section-number">18.4.2</span> Finding Unusual Observations</h3>
<p><strong>Studentized residuals</strong></p>
<p><span class="math display">\[r_{i}=\frac{\hat{\varepsilon}_{i}}{\hat{\sigma} \sqrt{1-h_{i}}}\]</span></p>
<p>如果模型假设正确, 则var <span class="math inline">\(\mathrm{r}_{i}=1\)</span>
and <span class="math inline">\(\operatorname{corr}\left(r_{i,}, r_{j}\right)\)</span> 倾向于很小。
在残差图中,有时首选学生化残差, 因为它们已经标准化为具有相等的方差。
当误差具有恒定方差时，学生化只能校正残差的自然非恒定方差。
如果错误中存在一些潜在的异方差，则学生化无法对其进行校正。</p>
<p><strong>Outlier</strong></p>
<p>An outlier is a point that does not fit the current model. We need to be aware of such exceptions. An outlier test is useful because it enables us to distinguish between truly unusual observations and residuals that are large, but not exceptional</p>
<p>In linear regression, an outlier is an observation with a large residual. In other words, it is an observation whose dependent-variable value is unusual given its value on the predictor variables. An outlier may indicate a sample peculiarity or may indicate a data entry error or other problem.</p>
<p><span class="math display">\[
\hat{y}_{(i)}=x_{i}^{T} \hat{\beta}_{(i)}
\]</span>
If <span class="math inline">\(\hat{y}_{(i)}-y_{i}\)</span> is large, then case <span class="math inline">\(i\)</span> is an outlier. To judge the size of potential outliers, we need to scale appropriately. we discover:
<span class="math display">\[
\text { vâr } \left.\left(y_{i}-\hat{y}_{(i)}\right)=\hat{\sigma}_{(i)}^{2}\left(1+x_{i}^{T}\left(X_{(i)}^{T} X_{(i)}\right)\right)^{-1} x_{i}\right)
\]</span>
Therefore, we take the residuals of the jackknife (or externally learned or cross-validated)
<span class="math display">\[
t_{i}=\frac{y_{i}-\hat{y}_{(i)}}{\left.\hat{\sigma}_{(i)}\left(1+x_{i}^{T}\left(X_{(i)}^{T} X_{(i)}\right)\right)^{-1} x_{i}\right)^{1 / 2}}
\]</span>
which are distributed <span class="math inline">\(t n-p-1\)</span> if the model is correct and <span class="math inline">\(\varepsilon \sim \mathrm{N}\left(0, \sigma^{2} I\right)\)</span>. Fortunately, there is an easier way to compute <span class="math inline">\(t i\)</span>
<span class="math display">\[
t_{i}=\frac{\hat{\varepsilon}_{i}}{\hat{\sigma}_{(i)} \sqrt{1-h_{i}}}=r_{i}\left(\frac{n-p-1}{n-p-r_{i}^{2}}\right)^{1 / 2}
\]</span>
避免进行n回归。由于 <span class="math inline">\(t_{i} \sim t_{n-p-1}\)</span>, 我们可以计算一个值来测试 情况i是否是异常值。</p>
<p><strong>Leverage</strong></p>
<p>An observation with an extreme value on a predictor variable is a point with high leverage. Leverage is a measure of how far an independent variable deviates from its mean. High leverage points can have a great amount of effect on the estimate of regression coefficients.
<span class="math inline">\(h_{i}=H_{i i}\)</span> are called leverages and are useful diagnostics. Since
var <span class="math inline">\(\hat{\varepsilon}_{i}=\sigma^{2}\left(1-h_{i}\right)\)</span>, a large leverage, <span class="math inline">\(h_{i}\)</span>, will make var <span class="math inline">\(\hat{\varepsilon}_{i}\)</span>
small.</p>
<p><strong>Influence</strong></p>
<p>An observation is said to be influential if removing the observation substantially changes the estimate of the regression coefficients. Influence can be thought of as the product of leverage and outlierness.</p>
<p>Consider the change in the fit <span class="math inline">\(X^{T}\left(\hat{\boldsymbol{\beta}}-\hat{\boldsymbol{\beta}}_{(i)}\right)=\hat{y}-\hat{y}_{(i)}\)</span> The
Cook statistics are a popular influence diagnostic because they reduce the information to a single value for each case. They are defined as:
<span class="math display">\[
\begin{aligned}
D_{i} &amp;=\frac{\left(\hat{y}-\hat{y}_{(i)}\right)^{T}\left(\hat{y}-\hat{y}_{(i)}\right)}{p \hat{\sigma}^{2}} \\
&amp;=\frac{1}{p} r_{i}^{2} \frac{h_{i}}{1-h_{i}}
\end{aligned}
\]</span></p>
</div>
<div id="checking-the-structure-of-the-model" class="section level3">
<h3><span class="header-section-number">18.4.3</span> Checking the Structure of the Model</h3>
<p>We can look at plots of <span class="math inline">\(\hat{\varepsilon}\)</span> against <span class="math inline">\(\hat{y}\)</span> and <span class="math inline">\(x_{i}\)</span> to reveal problems
or just simply look at plots of <span class="math inline">\(y\)</span> against each <span class="math inline">\(x_{i} .\)</span></p>
<p>The disadvantage of these graphs is that other predictor variables affect the relationship. Partial regression or increased variable graph can help isolate the effect of <span class="math inline">\(x_{i}\)</span>
Look at the response that removes the expected effect of other <span class="math inline">\(X_s\)</span>:
<strong>Partial regression (left) and partial residual (right) plots</strong></p>
<p><span class="math display">\[
y-\sum_{j \neq i} x_{j} \hat{\beta}_{j}=\hat{y}+\hat{\varepsilon}-\sum_{j \neq i} x_{j} \hat{\beta}_{j}=x_{i} \hat{\beta}_{i}+\hat{\varepsilon}
\]</span></p>
</div>
</div>
<div id="sas-implementation-proc-reg" class="section level2">
<h2><span class="header-section-number">18.5</span> SAS implementation Proc Reg</h2>
<div id="options" class="section level3">
<h3><span class="header-section-number">18.5.1</span> Options</h3>
<table>
<thead>
<tr class="header">
<th>Options</th>
<th>Descriptation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>STB</td>
<td>输出标准化偏回归系数矩阵</td>
</tr>
<tr class="even">
<td>CORRB</td>
<td>输出参数估计矩阵</td>
</tr>
<tr class="odd">
<td>COLLINOINT</td>
<td>自变量进行共线性分析</td>
</tr>
<tr class="even">
<td>P</td>
<td>输出个体观测值、预测值及残差</td>
</tr>
<tr class="odd">
<td>R</td>
<td>输出每个个体观测值、残差及标准误差</td>
</tr>
<tr class="even">
<td>CLM</td>
<td>输出因变量均值95％的置信界限的上下限</td>
</tr>
<tr class="odd">
<td>CLI</td>
<td>对各预测值输出95％的置信界限的上下限</td>
</tr>
<tr class="even">
<td>MSE</td>
<td>要求输出随机扰动项方差</td>
</tr>
<tr class="odd">
<td>VIF</td>
<td>输出变量间相关性的方差膨胀系数，VIF越大，说明由于共线性存在，使方差变大</td>
</tr>
<tr class="even">
<td>TOL</td>
<td>表示共线性水平的容许值，TOL越小说明其可用别的自变量解释的部分多，</td>
</tr>
<tr class="odd">
<td>自然可能与别的自变量存在共线性关系；</td>
<td></td>
</tr>
<tr class="even">
<td>DW</td>
<td>输出Durbin-Watson统计量</td>
</tr>
<tr class="odd">
<td>influence</td>
<td>对异常点进行诊断，对每一观测点输出统计量(Cook’s D &gt; 50％,</td>
</tr>
<tr class="even">
<td>defits/debetas &gt; 2说明该点影响较大）</td>
<td></td>
</tr>
<tr class="odd">
<td>Plot Options</td>
<td></td>
</tr>
<tr class="even">
<td>FITPLOT</td>
<td>带回归线、置信预测带的散点图</td>
</tr>
<tr class="odd">
<td>RESIDUALS</td>
<td>自变量的残差</td>
</tr>
<tr class="even">
<td>DIAGNOSTICS</td>
<td>诊断图（包括下面各图）</td>
</tr>
<tr class="odd">
<td>COOKSD</td>
<td>CookIs D统计量图</td>
</tr>
<tr class="even">
<td>OBSERVEDBYPREDICTED</td>
<td>根据预测值的因变量图</td>
</tr>
<tr class="odd">
<td>QQPLOT</td>
<td>检验残差正态性的图</td>
</tr>
<tr class="even">
<td>RESIDUALBYPREDICTED</td>
<td>根据预测值的残差图</td>
</tr>
<tr class="odd">
<td>RESIDUALHISTOGRAM</td>
<td>残差的直方图</td>
</tr>
<tr class="even">
<td>RFPLOT</td>
<td>残差拟合图</td>
</tr>
<tr class="odd">
<td>RSTUDENTBYLEVERAGE</td>
<td>杠杆比率的学生化残差图</td>
</tr>
<tr class="even">
<td>RSTUDENTBYPREDICTED</td>
<td>预测值的学生化残差图</td>
</tr>
</tbody>
</table>
</div>
<div id="diagnose" class="section level3">
<h3><span class="header-section-number">18.5.2</span> Diagnose</h3>
<p><strong>Hat matrix diagonal SAS</strong></p>
<p>The hat matrix diagonal measure is used to identify unusual values of the explanatory variables. The hat matrix depends only on the explanatory values and not on the dependent y values. The interpretation, then, is that the hat matrix is a measure of leverage among the independent, explanatory variables only. In contrast, a plot of residuals identifies observations that are unusual in terms of their Y values that we wish to explain. The hat matrix diagonal measure is used to identify unusual values of the explanatory variables.</p>
<p>The “U” shape is a shape common to most hat matrix diagrams. We can think that the highest and lowest observed values of the explanatory variables are also the furthest away from the data center and will have the greatest impact. Observations close to the data center should have the least influence.</p>
<!-- 
帽子矩阵仅取决于解释性值，而不取决于相关的y值。 因此，解释是帽子矩阵仅是独立，解释性变量之间杠杆作用的量度。 相比之下，残差图可标识出我们希望解释的，在Y值方面不寻常的观察结果。

“ U”形是大多数帽子矩阵图所共有的形状。我们可以认为，解释变量的最高和
最低观测值也离数据中心最远，并且将产生最大的影响。靠近数据中心的观测
值应具有最小的影响力。
-->
<pre><code>proc reg data=cold;
    model maxt = lat long alt / p r influence ;
    output out=inf h=h p=p r=r;
    run;
proc gplot data=inf;
    plot h * p;
run;</code></pre>
<p><strong>Jackknife Diagnostics SAS</strong></p>
<p>The jackknife measures how much the fitted model changes when one observation is deleted and the model is refitted. If an observation is deleted from the data set, and the new fit is very different from the original model based on the complete data set, the observation is considered to have an impact on the fit</p>
<pre><code>proc reg data=cold;
title2 ’Explain max Jan temperature’;
model maxt = lat long alt / p influence partial;
ods output OutputStatistics = diag;
run;
title2 ’Examine diagnostic data set’;
proc print data=diag;
run;</code></pre>
<p><strong>Partial Regression Plots SAS</strong></p>
<p>One way to solve the problem of the individual contribution of each explanatory variable is to use partial correlation and partial regression plots. These are obtained using the /partial option in proc reg.</p>
<pre><code>proc reg data=lowbw;
    model birthwt = headcirc length gestage momage toxemia
    / partial influence p r pcorr1 pcorr2;
    ods output OutputStatistics = diag;
run;</code></pre>
</div>
</div>
<div id="r-implementation" class="section level2">
<h2><span class="header-section-number">18.6</span> R implementation</h2>
<table>
<thead>
<tr class="header">
<th>Title</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>预测值</td>
<td>fitted(bank.lm)</td>
</tr>
<tr class="even">
<td>求模型系数</td>
<td>coef(bank.lm)</td>
</tr>
<tr class="odd">
<td>计算残差平方和</td>
<td>deviance(bank.lm)</td>
</tr>
<tr class="even">
<td>计算残差</td>
<td>residuals(bank.lm)</td>
</tr>
<tr class="odd">
<td>方差分析表</td>
<td>anova(bank.lm)</td>
</tr>
<tr class="even">
<td>Konfidenzintervall</td>
<td>confint(bank.lm, level=0.95)</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td>异方差检验</td>
<td>library(car)</td>
</tr>
<tr class="odd">
<td></td>
<td>ncvTest(bank.lm)</td>
</tr>
<tr class="even">
<td>共线性检验：VIF&gt;10</td>
<td>vif(bank.lm)</td>
</tr>
<tr class="odd">
<td>自相关性检验</td>
<td>durbinWatsonTest(bank.lm)</td>
</tr>
<tr class="even">
<td>高杠杆点: 大于均值的2~3倍</td>
<td>hatvalues(bank.lm)</td>
</tr>
<tr class="odd">
<td>强影响点</td>
<td>cooks.distance(bank.lm)</td>
</tr>
<tr class="even">
<td>离群点、高杠杆点、强影响点</td>
<td>influence.measures(bank.lm)</td>
</tr>
<tr class="odd">
<td></td>
<td>influencePlot(bank.lm)</td>
</tr>
</tbody>
</table>
<p>ncvTest(bank.lm)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="non-parametric-test.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced-linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/18-Regression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
